<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>BIBZ HIT â€” Fitness Tracker</title>
<meta name="description" content="Bibz Hit â€” Ton tracker fitness personnel">
<meta name="theme-color" content="#06060e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BIBZ HIT">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#06060e;--ink2:#0d0d1a;--ink3:#13131f;--ink4:#1a1a28;
  --glass:rgba(255,255,255,0.04);--glass2:rgba(255,255,255,0.08);
  --rim:rgba(255,255,255,0.07);--rim2:rgba(255,255,255,0.13);
  --lime:#c6ff00;--lime2:#a8db00;--lime-glow:rgba(198,255,0,0.18);
  --red:#ff3b3b;--blue:#3b8bff;--orange:#ff8c00;--teal:#00e5cc;
  --txt:#eeeef8;--txt2:rgba(238,238,248,0.55);--txt3:rgba(238,238,248,0.28);
  --r8:8px;--r12:12px;--r16:16px;--r20:20px;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{background:var(--ink);color:var(--txt);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden;-webkit-tap-highlight-color:transparent}
/* Native press feel on mobile */
@media(hover:none){
  .btn:active{transform:scale(0.97);opacity:.85}
  .exc:active{transform:scale(0.98);opacity:.9}
  .wo-item:active{transform:scale(0.99);opacity:.85}
  .mob-nav-btn:active .mn-icon{transform:scale(0.88)}
  .fb:active{transform:scale(0.95)}
}
.pg{padding-bottom:env(safe-area-inset-bottom, 40px)}

/* â”€â”€ NOISE TEXTURE â”€â”€ */
body::before{content:'';position:fixed;inset:0;opacity:.025;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");pointer-events:none;z-index:0}

/* â”€â”€ AMBIENT GLOW â”€â”€ */
body::after{content:'';position:fixed;top:-30vh;left:-20vw;width:70vw;height:70vh;background:radial-gradient(ellipse,rgba(198,255,0,0.04) 0%,transparent 65%);pointer-events:none;z-index:0}

/* â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â• */
nav{position:fixed;top:0;left:0;right:0;z-index:200;height:56px;background:rgba(6,6,14,0.88);backdrop-filter:blur(20px) saturate(1.5);border-bottom:1px solid var(--rim);display:flex;align-items:center;padding:0 20px;gap:4px}
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:2px;color:var(--lime);margin-right:16px;line-height:1}
.logo span{color:var(--txt2);font-size:0.9rem;letter-spacing:0;font-family:'Outfit',sans-serif;font-weight:300;vertical-align:middle;margin-left:4px}
.nb{background:none;border:none;cursor:pointer;color:var(--txt3);font-family:'Outfit',sans-serif;font-size:.8rem;font-weight:500;padding:6px 12px;border-radius:var(--r8);transition:all .18s;letter-spacing:.3px}
.nb:hover{color:var(--txt);background:var(--glass2)}
.nb.on{color:var(--lime);background:rgba(198,255,0,0.08);font-weight:600}
.nb-icon{font-size:.95rem;margin-right:4px}
.nav-sp{flex:1}
.save-dot{width:7px;height:7px;border-radius:50%;background:var(--lime);box-shadow:0 0 8px var(--lime-glow);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* â•â•â•â•â•â•â•â•â•â• PAGES â•â•â•â•â•â•â•â•â•â• */
.pg{display:none;padding:72px 20px 40px;max-width:1100px;margin:0 auto;position:relative;z-index:1}
.pg.on{display:block;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â•â•â•â•â•â•â•â• TYPOGRAPHY â•â•â•â•â•â•â•â•â•â• */
.page-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,4vw,3rem);letter-spacing:2px;line-height:1;margin-bottom:4px}
.page-sub{color:var(--txt2);font-size:.88rem;margin-bottom:24px;font-weight:300}
.sec{font-size:.68rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:2px;margin:20px 0 10px}

/* â•â•â•â•â•â•â•â•â•â• CARDS â•â•â•â•â•â•â•â•â•â• */
.card{background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r16);padding:20px}
.card-sm{padding:14px 16px}
.card-glow{box-shadow:0 0 0 1px var(--rim),0 8px 32px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.05)}
.hov{transition:all .22s cubic-bezier(.4,0,.2,1)}
.hov:hover{transform:translateY(-3px);border-color:var(--rim2);box-shadow:0 12px 40px rgba(0,0,0,.5)}

/* â•â•â•â•â•â•â•â•â•â• STAT CARDS â•â•â•â•â•â•â•â•â•â• */
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:20px}
.sc{background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r12);padding:14px 16px;position:relative;overflow:hidden}
.sc::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 80% 20%,var(--sc-glow,rgba(198,255,0,.07)),transparent 60%)}
.sc-lbl{font-size:.65rem;font-weight:600;color:var(--txt3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px}
.sc-val{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--sc-col,var(--lime));line-height:1;letter-spacing:1px}
.sc-unit{font-size:.7rem;color:var(--txt3);margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â• EXERCISE CARDS â•â•â•â•â•â•â•â•â•â• */
.ex-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.exc{background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r16);overflow:hidden;cursor:pointer;transition:all .22s cubic-bezier(.4,0,.2,1);position:relative}
.exc:hover{transform:translateY(-4px) scale(1.01);border-color:var(--rim2);box-shadow:0 20px 50px rgba(0,0,0,.6)}
.exc-img{height:150px;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.exc-img img{width:100%;height:100%;object-fit:cover;transition:transform .4s ease}
.exc:hover .exc-img img{transform:scale(1.06)}
.exc-badge{position:absolute;top:8px;right:8px;background:rgba(6,6,14,.8);backdrop-filter:blur(6px);border:1px solid var(--rim2);border-radius:20px;padding:2px 8px;font-size:.65rem;font-weight:700;color:var(--lime);letter-spacing:.5px}
.exc-body{padding:12px 14px}
.exc-name{font-weight:700;font-size:.9rem;margin-bottom:4px;line-height:1.2}
.exc-tags{display:flex;gap:4px;flex-wrap:wrap}
.tag{font-size:.62rem;font-weight:600;padding:2px 7px;border-radius:10px;letter-spacing:.3px}
.tm{background:rgba(198,255,0,.1);color:var(--lime)}
.tg{background:rgba(59,139,255,.12);color:#7db8ff}
.tc{background:rgba(255,92,92,.1);color:#ff8080}
.tk{background:rgba(0,229,204,.1);color:var(--teal)}
.tp{background:rgba(255,140,0,.1);color:#ffa830}

/* â•â•â•â•â•â•â•â•â•â• SEARCH / FILTERS â•â•â•â•â•â•â•â•â•â• */
.search-wrap{position:relative;margin-bottom:12px}
.search-wrap input{width:100%;background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r12);padding:10px 16px 10px 40px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:.9rem;outline:none;transition:border-color .2s}
.search-wrap input:focus{border-color:rgba(198,255,0,.4)}
.search-wrap input::placeholder{color:var(--txt3)}
.search-wrap::before{content:'ğŸ”';position:absolute;left:13px;top:50%;transform:translateY(-50%);font-size:.85rem}
.filters{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.fb{padding:4px 14px;border-radius:20px;border:1px solid var(--rim);background:none;color:var(--txt2);font-size:.76rem;cursor:pointer;font-family:'Outfit',sans-serif;font-weight:500;transition:all .16s}
.fb:hover{color:var(--txt);border-color:var(--rim2)}
.fb.on{background:var(--lime);color:#000;border-color:var(--lime);font-weight:700}

/* â•â•â•â•â•â•â•â•â•â• FORMS â•â•â•â•â•â•â•â•â•â• */
.fg{display:flex;flex-direction:column;gap:6px}
.fg label{font-size:.68rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:1px}
.fg input,.fg select,.fg textarea{background:var(--ink4);border:1px solid var(--rim);border-radius:var(--r8);padding:10px 13px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:.88rem;outline:none;transition:border-color .2s;width:100%;-webkit-appearance:none;appearance:none}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:rgba(198,255,0,.4)}
.fg select option{background:#1a1a28}
.fg textarea{resize:vertical;min-height:72px;line-height:1.5}
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fgrid .full{grid-column:1/-1}
.fgrid .triple{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;grid-column:1/-1}

/* â•â•â•â•â•â•â•â•â•â• BUTTONS â•â•â•â•â•â•â•â•â•â• */
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 22px;border-radius:var(--r8);border:none;cursor:pointer;font-family:'Outfit',sans-serif;font-weight:600;font-size:.85rem;transition:all .18s;letter-spacing:.2px}
.btn-lime{background:var(--lime);color:#000;box-shadow:0 0 20px rgba(198,255,0,.2)}
.btn-lime:hover{background:var(--lime2);transform:translateY(-2px);box-shadow:0 4px 24px rgba(198,255,0,.35)}
.btn-ghost{background:var(--glass);color:var(--txt);border:1px solid var(--rim)}
.btn-ghost:hover{background:var(--glass2);border-color:var(--rim2)}
.btn-red{background:rgba(255,59,59,.12);color:#ff6e6e;border:1px solid rgba(255,59,59,.25)}
.btn-red:hover{background:rgba(255,59,59,.22)}
.btn-teal{background:rgba(0,229,204,.1);color:var(--teal);border:1px solid rgba(0,229,204,.25)}
.btn-orange{background:rgba(255,140,0,.1);color:#ffa830;border:1px solid rgba(255,140,0,.25)}
.btn-sm{padding:5px 12px;font-size:.76rem;border-radius:6px}
.btn-full{width:100%;justify-content:center}
.btn-icon{background:none;border:1px solid var(--rim);color:var(--txt3);width:28px;height:28px;border-radius:6px;cursor:pointer;font-size:.8rem;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.btn-icon:hover{border-color:var(--red);color:var(--red)}

/* â•â•â•â•â•â•â•â•â•â• SESSION LOG â•â•â•â•â•â•â•â•â•â• */
.session-type-pick{display:flex;gap:8px;margin-bottom:20px;background:var(--ink3);border-radius:var(--r12);padding:4px;border:1px solid var(--rim)}
.stp{flex:1;padding:10px;border:none;background:none;color:var(--txt2);font-family:'Outfit',sans-serif;font-size:.83rem;font-weight:600;border-radius:var(--r8);cursor:pointer;transition:all .18s;text-align:center}
.stp.on{background:var(--ink4);color:var(--txt);border:1px solid var(--rim2)}
.stp.on.lime{color:var(--lime)}
.stp.on.orange{color:var(--orange);border-color:rgba(255,140,0,.3)}
.stp.on.teal{color:var(--teal);border-color:rgba(0,229,204,.3)}

.ex-log-item{background:var(--ink4);border:1px solid var(--rim);border-radius:var(--r12);margin-bottom:8px;overflow:hidden}
.eli-head{display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer}
.eli-thumb{width:48px;height:48px;border-radius:var(--r8);overflow:hidden;flex-shrink:0}
.eli-thumb img{width:100%;height:100%;object-fit:cover}
.eli-info{flex:1;min-width:0}
.eli-name{font-weight:600;font-size:.9rem}
.eli-meta{font-size:.72rem;color:var(--txt2)}
.eli-body{padding:0 14px 14px;border-top:1px solid var(--rim)}

/* â•â•â•â•â•â•â•â•â•â• SETS â•â•â•â•â•â•â•â•â•â• */
.set-row{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:6px;background:var(--glass);margin-bottom:4px;transition:background .15s}
.set-row:hover{background:var(--glass2)}
.set-n{font-size:.7rem;color:var(--txt3);font-weight:700;width:22px;text-align:center}
.set-in{width:72px;padding:5px 8px;text-align:center;font-size:.82rem;background:var(--ink3);border:1px solid var(--rim);border-radius:6px;color:var(--txt);font-family:'Outfit',sans-serif;transition:border-color .15s;-webkit-appearance:none;appearance:none}
.set-in:focus{border-color:rgba(198,255,0,.4);outline:none}
.set-u{font-size:.68rem;color:var(--txt3);min-width:22px}
.set-done{width:24px;height:24px;border-radius:4px;border:1px solid var(--rim);background:none;cursor:pointer;font-size:.75rem;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0;color:var(--txt3)}
.set-done.done{background:var(--lime);border-color:var(--lime);color:#000}
.set-del{background:none;border:none;color:var(--txt3);cursor:pointer;font-size:.75rem;padding:2px 4px;border-radius:4px;transition:color .15s;flex-shrink:0}
.set-del:hover{color:var(--red)}

/* Cardio set */
.cardio-row{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;background:var(--glass);margin-bottom:6px}
.cr-label{font-size:.7rem;color:var(--txt3);width:50px;font-weight:600}
.cr-in{flex:1;padding:5px 8px;font-size:.82rem;background:var(--ink3);border:1px solid var(--rim);border-radius:6px;color:var(--txt);font-family:'Outfit',sans-serif;outline:none;transition:border-color .15s;-webkit-appearance:none}
.cr-in:focus{border-color:rgba(0,229,204,.4)}

/* â•â•â•â•â•â•â•â•â•â• REST TIMER â•â•â•â•â•â•â•â•â•â• */
.rest-timer{position:fixed;bottom:calc(80px + env(safe-area-inset-bottom));right:16px;z-index:300;background:var(--ink3);border:1px solid var(--lime);border-radius:var(--r16);padding:16px 20px;display:none;box-shadow:0 8px 32px rgba(198,255,0,.15);min-width:200px}
.rest-timer.show{display:block;animation:slideIn .3s ease}
@keyframes slideIn{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.rt-title{font-size:.65rem;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:2px;margin-bottom:4px}
.rt-time{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;color:var(--lime);letter-spacing:2px;line-height:1}
.rt-bar{height:3px;background:var(--rim);border-radius:2px;margin-top:8px;overflow:hidden}
.rt-fill{height:100%;background:var(--lime);border-radius:2px;transition:width .9s linear}
.rt-btns{display:flex;gap:6px;margin-top:10px}

/* â•â•â•â•â•â•â•â•â•â• WORKOUT LIST â•â•â•â•â•â•â•â•â•â• */
.wo-item{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r12);margin-bottom:6px;cursor:pointer;transition:all .2s}
.wo-item:hover{border-color:var(--rim2);transform:translateX(3px)}
.wo-type-badge{width:40px;height:40px;border-radius:var(--r8);display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.wo-info{flex:1;min-width:0}
.wo-name{font-weight:600;font-size:.92rem;margin-bottom:2px}
.wo-meta{font-size:.72rem;color:var(--txt2)}
.wo-stats{display:flex;flex-direction:column;align-items:flex-end;gap:2px}
.wo-kcal{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;color:var(--lime);letter-spacing:1px}
.wo-dur{font-size:.7rem;color:var(--txt3)}

/* â•â•â•â•â•â•â•â•â•â• CHARTS â•â•â•â•â•â•â•â•â•â• */
.chart-box{background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r16);padding:20px}
.chart-hd{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:1.5px;color:var(--txt2);text-transform:uppercase;margin-bottom:16px}
.bars{display:flex;align-items:flex-end;gap:4px;height:100px;padding-bottom:0}
.bar-c{display:flex;flex-direction:column;align-items:center;flex:1;gap:3px}
.bar-f{width:100%;border-radius:3px 3px 0 0;min-height:3px;position:relative;cursor:default;transition:height .7s cubic-bezier(.4,0,.2,1)}
.bar-f::after{content:attr(data-tip);display:none;position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--ink2);border:1px solid var(--rim2);color:var(--txt);font-size:.68rem;padding:3px 8px;border-radius:5px;white-space:nowrap;pointer-events:none;z-index:10}
.bar-f:hover::after{display:block}
.bar-xl{font-size:.58rem;color:var(--txt3);text-align:center;white-space:nowrap;overflow:hidden}

/* Line chart */
.line-box{position:relative;height:120px;margin:4px}

/* Muscle heatmap */
.mheat{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.mh-row{background:var(--ink4);border-radius:6px;padding:8px 12px}
.mh-top{display:flex;justify-content:space-between;font-size:.78rem;margin-bottom:5px}
.mh-name{font-weight:500}
.mh-cnt{font-family:'Bebas Neue',sans-serif;font-size:.9rem;color:var(--lime)}
.mh-tr{height:4px;background:var(--glass2);border-radius:2px;overflow:hidden}
.mh-tf{height:100%;border-radius:2px;background:linear-gradient(90deg,#7c5cfc,var(--lime));transition:width .9s ease}

/* â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â• */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:400;display:none;align-items:center;justify-content:center;padding:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}
.overlay.on{display:flex;animation:fade .2s}
@keyframes fade{from{opacity:0}to{opacity:1}}
.modal{background:var(--ink2);border:1px solid var(--rim2);border-radius:var(--r20);padding:24px;width:100%;max-height:88vh;overflow-y:auto;-webkit-overflow-scrolling:touch;animation:mSlide .28s ease}
.modal-sm{max-width:460px}.modal-md{max-width:580px}.modal-lg{max-width:720px}
@keyframes mSlide{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.mhd{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;gap:12px}
.mclose{background:var(--glass);border:1px solid var(--rim);color:var(--txt2);width:36px;height:36px;border-radius:var(--r8);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;flex-shrink:0}

/* â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â• */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);z-index:600;background:var(--ink3);border:1px solid var(--rim2);color:var(--txt);padding:10px 20px;border-radius:10px;font-size:.84rem;font-weight:500;opacity:0;transition:all .3s ease;pointer-events:none;white-space:nowrap;box-shadow:0 8px 24px rgba(0,0,0,.5)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:rgba(198,255,0,.4);background:rgba(198,255,0,.08)}
.toast.err{border-color:rgba(255,59,59,.4);background:rgba(255,59,59,.08)}
.toast.pr{border-color:rgba(255,215,0,.5);background:rgba(255,215,0,.08);color:#ffd700;font-weight:700}

/* â•â•â•â•â•â•â•â•â•â• CONFIRM â•â•â•â•â•â•â•â•â•â• */
.confirm-box{background:var(--ink2);border:1px solid rgba(255,59,59,.3);border-radius:var(--r16);padding:24px;max-width:380px;width:100%}
.confirm-box h3{color:var(--red);font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:1px;margin-bottom:8px}
.confirm-box p{color:var(--txt2);font-size:.86rem;line-height:1.6;margin-bottom:20px}

/* â•â•â•â•â•â•â•â•â•â• POIDS CHART â•â•â•â•â•â•â•â•â•â• */
.weight-delta{font-size:.78rem;padding:3px 8px;border-radius:6px;font-weight:600}
.wd-pos{background:rgba(0,229,204,.1);color:var(--teal)} 
.wd-neg{background:rgba(198,255,0,.1);color:var(--lime)}
.wd-neu{background:var(--glass);color:var(--txt2)}

/* â•â•â•â•â•â•â•â•â•â• PROGRESS â•â•â•â•â•â•â•â•â•â• */
.tab-bar{display:flex;gap:4px;background:var(--ink3);border-radius:var(--r12);padding:3px;border:1px solid var(--rim);margin-bottom:20px}
.tbtn{flex:1;padding:8px;border:none;background:none;color:var(--txt3);font-family:'Outfit',sans-serif;font-size:.78rem;font-weight:600;border-radius:var(--r8);cursor:pointer;transition:all .18s;text-align:center}
.tbtn.on{background:var(--ink4);color:var(--txt);border:1px solid var(--rim);font-weight:700}

/* â•â•â•â•â•â•â•â•â•â• BODY SCAN â•â•â•â•â•â•â•â•â•â• */
.body-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.bm-card{background:var(--ink4);border:1px solid var(--rim);border-radius:var(--r8);padding:10px 13px}
.bm-lbl{font-size:.65rem;color:var(--txt3);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;font-weight:600}
.bm-val{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--txt);letter-spacing:1px}
.bm-unit{font-size:.7rem;color:var(--txt3)}

/* â•â•â•â•â•â•â•â•â•â• PR TABLE â•â•â•â•â•â•â•â•â•â• */
.pr-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--rim)}
.pr-row:last-child{border-bottom:none}
.pr-pos{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;width:28px;text-align:center}
.pr-info{flex:1}
.pr-name{font-size:.88rem;font-weight:500}
.pr-date{font-size:.7rem;color:var(--txt3)}
.pr-kg{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;color:var(--lime);letter-spacing:1px}

/* â•â•â•â•â•â•â•â•â•â• DETAIL MODAL â•â•â•â•â•â•â•â•â•â• */
.det-img{height:220px;border-radius:var(--r12);overflow:hidden;margin-bottom:16px;position:relative}
.det-img img{width:100%;height:100%;object-fit:cover}
.det-img-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(6,6,14,.9) 0%,transparent 50%)}
.det-img-info{position:absolute;bottom:14px;left:16px;right:16px}
.det-muscles{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.det-stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.det-stat{background:var(--ink4);border-radius:var(--r8);padding:12px;text-align:center;border:1px solid var(--rim)}
.det-stat-lbl{font-size:.62rem;color:var(--txt3);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;font-weight:600}
.det-stat-val{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;color:var(--lime);letter-spacing:1px}
.tips-list{background:var(--ink4);border-radius:var(--r8);padding:12px 16px;margin-bottom:16px}
.tip-item{display:flex;gap:8px;font-size:.83rem;padding:5px 0;color:var(--txt2);line-height:1.5}
.tip-item::before{content:'â†’';color:var(--lime);flex-shrink:0;font-weight:700}

/* â•â•â•â•â•â•â•â•â•â• CUSTOM EX â•â•â•â•â•â•â•â•â•â• */
.ce-preview{height:90px;border-radius:var(--r8);border:1px solid var(--rim);display:flex;align-items:center;justify-content:center;font-size:3rem;background:var(--ink4);margin-bottom:8px;transition:background .2s}

/* â•â•â•â•â•â•â•â•â•â• WORKOUT SUMMARY â•â•â•â•â•â•â•â•â•â• */
.summary-bar{background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r16);padding:16px;margin-top:12px}
.sum-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0;text-align:center}
.sum-item{padding:8px;border-right:1px solid var(--rim)}
.sum-item:last-child{border-right:none}
.sum-lbl{font-size:.62rem;color:var(--txt3);text-transform:uppercase;letter-spacing:1px;font-weight:600;margin-bottom:4px}
.sum-val{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;color:var(--lime);letter-spacing:1px}

/* â•â•â•â•â•â•â•â•â•â• WATER TRACKER â•â•â•â•â•â•â•â•â•â• */
.water-track{display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin:8px 0}
.water-btn{width:32px;height:32px;border-radius:8px;background:rgba(59,139,255,.08);border:1px solid rgba(59,139,255,.2);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:all .18s;padding:0}
.water-btn.filled{background:rgba(59,139,255,.25);border-color:rgba(59,139,255,.5)}
.water-btn:hover{transform:scale(1.1)}

/* â•â•â•â•â•â•â•â•â•â• MOTIVATIONAL QUOTE â•â•â•â•â•â•â•â•â•â• */
.quote-bar{background:linear-gradient(135deg,rgba(198,255,0,0.04),rgba(0,229,204,0.04));border:1px solid rgba(198,255,0,0.1);border-radius:var(--r12);padding:12px 16px;margin-bottom:16px;display:flex;gap:10px;align-items:flex-start}
.quote-icon{font-size:1.2rem;flex-shrink:0;margin-top:2px}
.quote-text{font-size:.82rem;color:var(--txt2);line-height:1.6;font-style:italic}
.quote-author{font-size:.7rem;color:var(--txt3);margin-top:3px;font-weight:600;font-style:normal}

/* â•â•â•â•â•â•â•â•â•â• DASHBOARD EXTRAS â•â•â•â•â•â•â•â•â•â• */
.dash-extras{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:start;margin-bottom:12px}
.dash-water-card{min-width:160px}

/* â•â•â•â•â•â•â•â•â•â• MISC â•â•â•â•â•â•â•â•â•â• */
.hr{border:none;border-top:1px solid var(--rim);margin:16px 0}
.empty{text-align:center;padding:40px 16px;color:var(--txt3)}
.empty-icon{font-size:3rem;opacity:.3;margin-bottom:10px}
.empty p{font-size:.86rem;line-height:1.7}
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;letter-spacing:.3px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.flex-bc{display:flex;align-items:center;justify-content:space-between}
.flex-c{display:flex;align-items:center;gap:8px}

/* â•â•â•â•â•â•â•â•â•â• BOTTOM MOBILE NAV â•â•â•â•â•â•â•â•â•â• */
.mob-nav{
  display:none;
  position:fixed;bottom:0;left:0;right:0;z-index:300;
  background:rgba(8,8,18,0.98);
  -webkit-backdrop-filter:blur(30px) saturate(2);
  backdrop-filter:blur(30px) saturate(2);
  border-top:1px solid rgba(198,255,0,0.12);
  grid-template-columns:repeat(5,1fr);
  padding-bottom:env(safe-area-inset-bottom,0px);
}
.mob-nav-btn{
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;
  background:none;border:none;cursor:pointer;
  min-height:60px;width:100%;padding:8px 2px;
  color:rgba(238,238,248,0.28);
  font-size:9px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;
  -webkit-tap-highlight-color:transparent;
  transition:color .15s;
  position:relative;
}
.mob-nav-btn .mn-icon{font-size:22px;line-height:1;transition:transform .2s}
.mob-nav-btn.on{color:#c6ff00}
.mob-nav-btn.on .mn-icon{transform:scale(1.15);filter:drop-shadow(0 0 8px rgba(198,255,0,.7))}
.mob-nav-btn-center .mn-icon{
  background:linear-gradient(135deg,#c6ff00,#7fff00);
  color:#000!important;border-radius:50%;
  width:46px;height:46px;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;
  box-shadow:0 0 20px rgba(198,255,0,.5),0 4px 12px rgba(0,0,0,.4);
  margin-bottom:2px;
}
.mob-nav-btn-center{color:rgba(238,238,248,0.5)!important}
.mob-nav-btn-center.on{color:#c6ff00!important}

/* â•â•â•â•â•â•â•â•â•â• MOBILE RESPONSIVE â•â•â•â•â•â•â•â•â•â• */
@media screen and (max-width:700px){

  /* â”€â”€ Bottom nav visible, top nav links hidden â”€â”€ */
  .mob-nav{display:grid}
  .nb{display:none!important}
  .nav-sp{display:none!important}
  nav{
    padding:0 20px!important;
    height:54px!important;
    background:rgba(6,6,14,0.98)!important;
    border-bottom:1px solid rgba(255,255,255,0.06)!important;
  }
  .logo{font-size:1.35rem!important}
  .save-dot{margin-left:auto}

  /* â”€â”€ Pages â€” content in thumb zone â”€â”€ */
  .pg{
    padding-top:62px!important;
    padding-left:16px!important;
    padding-right:16px!important;
    padding-bottom:calc(68px + env(safe-area-inset-bottom,0px) + 16px)!important;
    max-width:100%!important;
  }

  /* â”€â”€ Typography â”€â”€ */
  .page-title{font-size:2rem!important;letter-spacing:1px!important}
  .page-sub{font-size:.82rem!important;margin-bottom:16px!important}
  .sec{margin:16px 0 8px!important}
  .flex-bc{flex-wrap:wrap;gap:8px}

  /* â”€â”€ Grids â”€â”€ */
  .g2{grid-template-columns:1fr!important;gap:10px!important}
  .g3{grid-template-columns:1fr 1fr!important;gap:8px!important}
  .fgrid{grid-template-columns:1fr!important}
  .fgrid .triple{grid-template-columns:1fr 1fr!important;gap:8px!important}
  .mheat{grid-template-columns:1fr!important}
  .body-grid{grid-template-columns:1fr 1fr!important}

  /* â”€â”€ Stat cards â€” 2 cols, bigger â”€â”€ */
  .stats-row{grid-template-columns:1fr 1fr!important;gap:8px!important;margin-bottom:16px!important}
  .sc{padding:14px!important;border-radius:14px!important}
  .sc-val{font-size:1.8rem!important}
  .sc-lbl{font-size:.6rem!important}

  /* â”€â”€ Exercise grid â”€â”€ */
  .ex-grid{grid-template-columns:1fr 1fr!important;gap:10px!important}
  .exc{border-radius:14px!important}
  .exc-img{height:110px!important}
  .exc-name{font-size:.82rem!important}

  /* â”€â”€ Charts â”€â”€ */
  .bars{height:64px!important}
  .chart-box{padding:14px!important;border-radius:14px!important}
  .chart-hd{font-size:.85rem!important;margin-bottom:10px!important}

  /* â”€â”€ Workout list â”€â”€ */
  .wo-item{padding:12px!important;border-radius:12px!important}
  .wo-type-badge{width:40px!important;height:40px!important;font-size:1rem!important;border-radius:10px!important}
  .wo-name{font-size:.88rem!important}
  .wo-meta{font-size:.68rem!important}
  .wo-kcal{font-size:1rem!important}

  /* â”€â”€ Session type tabs â”€â”€ */
  .session-type-pick{gap:6px!important;padding:5px!important}
  .stp{font-size:.75rem!important;padding:10px 6px!important;border-radius:10px!important}

  /* â”€â”€ Summary bar â”€â”€ */
  .sum-grid{grid-template-columns:1fr 1fr!important}
  .sum-val{font-size:1.4rem!important}
  .sum-lbl{font-size:.58rem!important}

  /* â”€â”€ Set rows â€” big touch targets â”€â”€ */
  .set-row{padding:8px 10px!important;border-radius:10px!important;gap:10px!important}
  .set-in{
    width:64px!important;height:42px!important;
    font-size:16px!important;text-align:center;
    border-radius:10px!important;
  }
  .set-done{width:36px!important;height:36px!important;border-radius:8px!important;font-size:.9rem!important}
  .btn-icon{width:36px!important;height:36px!important;font-size:.9rem!important}
  .set-u{font-size:.65rem!important}

  /* â”€â”€ Cardio rows â”€â”€ */
  .cardio-row{padding:10px 12px!important;border-radius:10px!important}
  .cr-in{height:42px!important;font-size:16px!important}

  /* â”€â”€ Buttons â”€â”€ */
  .btn{min-height:48px!important;font-size:.88rem!important;border-radius:12px!important;padding:12px 20px!important}
  .btn-sm{min-height:40px!important;font-size:.8rem!important;padding:8px 14px!important}
  .btn-full{border-radius:14px!important}

  /* â”€â”€ Filter buttons â”€â”€ */
  .fb{padding:7px 14px!important;font-size:.74rem!important;min-height:36px!important}

  /* â”€â”€ Search â”€â”€ */
  .search-wrap input{height:46px!important;font-size:16px!important;border-radius:12px!important}

  /* â”€â”€ Tab bar â€” scrollable horizontal â”€â”€ */
  .tab-bar{overflow-x:auto;-webkit-overflow-scrolling:touch;flex-wrap:nowrap!important;gap:6px!important;padding:4px!important}
  .tbtn{white-space:nowrap;flex-shrink:0;font-size:.74rem!important;padding:9px 14px!important;min-height:38px!important}

  /* â”€â”€ Cards â”€â”€ */
  .card{padding:16px!important;border-radius:16px!important}
  .ex-log-item{border-radius:14px!important}
  .eli-head{padding:14px!important}
  .eli-thumb{width:44px!important;height:44px!important;border-radius:10px!important}
  .eli-name{font-size:.88rem!important}

  /* â”€â”€ Dashboard â”€â”€ */
  .dash-extras{grid-template-columns:1fr!important;gap:8px!important}
  .dash-water-card{min-width:unset!important}
  .water-track{display:grid!important;grid-template-columns:repeat(8,1fr)!important;gap:5px!important;margin:10px 0!important}
  .water-btn{width:100%!important;height:38px!important;border-radius:10px!important;font-size:1rem!important}

  /* â”€â”€ Quote bar â”€â”€ */
  .quote-bar{padding:12px!important;border-radius:12px!important}
  .quote-text{font-size:.8rem!important}

  /* â”€â”€ Modal as bottom sheet â”€â”€ */
  .overlay{padding:0!important;align-items:flex-end!important}
  .modal{
    border-radius:24px 24px 0 0!important;
    border:none!important;
    border-top:1px solid rgba(255,255,255,0.1)!important;
    max-height:92vh!important;
    padding:0 18px 28px!important;
    background:#0d0d1a!important;
  }
  .modal::before{
    content:'';display:block;
    width:36px;height:4px;
    background:rgba(255,255,255,0.18);border-radius:2px;
    margin:14px auto 18px;
    flex-shrink:0;
  }
  .modal-sm,.modal-md,.modal-lg{max-width:100%!important}
  .mhd{margin-bottom:16px!important}
  .mclose{width:36px!important;height:36px!important;font-size:1rem!important}

  /* â”€â”€ Detail modal â”€â”€ */
  .det-img{height:180px!important;border-radius:14px!important}
  .det-stats-row{grid-template-columns:repeat(3,1fr)!important;gap:8px!important}
  .det-stat{padding:10px 6px!important;border-radius:10px!important}
  .det-stat-val{font-size:1.1rem!important}
  .tips-list{padding:10px 14px!important}
  .tip-item{font-size:.8rem!important}

  /* â”€â”€ PR table â”€â”€ */
  .pr-row{padding:12px 0!important}
  .pr-name{font-size:.85rem!important}
  .pr-kg{font-size:1.1rem!important}

  /* â”€â”€ Body scan â”€â”€ */
  .bm-card{padding:12px!important}
  .bm-val{font-size:1.3rem!important}

  /* â”€â”€ Rest timer â”€â”€ */
  .rest-timer{
    bottom:calc(68px + env(safe-area-inset-bottom,0px) + 8px)!important;
    left:16px!important;right:16px!important;
    min-width:unset!important;border-radius:18px!important;
    padding:16px 18px!important;
  }
  .rt-time{font-size:2.2rem!important}

  /* â”€â”€ Toast â”€â”€ */
  .toast{
    bottom:calc(68px + env(safe-area-inset-bottom,0px) + 12px)!important;
    font-size:.82rem!important;
    border-radius:12px!important;
    padding:10px 18px!important;
  }

  /* â”€â”€ Prevent iOS zoom on inputs â”€â”€ */
  input,select,textarea{font-size:16px!important}
}

@media screen and (max-width:380px){
  .ex-grid{grid-template-columns:1fr!important}
  .stats-row{grid-template-columns:1fr 1fr!important}
  .page-title{font-size:1.7rem!important}
}

::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--rim2);border-radius:3px}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• NAV DESKTOP â•â•â•â•â•â•â•â•â•â•â• -->
<nav>
  <div class="logo">BIBZ<span>HIT</span></div>
  <button class="nb on" id="nb-dash" onclick="goPage('dash')"><span class="nb-icon">ğŸ </span>Dashboard</button>
  <button class="nb" id="nb-lib" onclick="goPage('lib')"><span class="nb-icon">ğŸ“š</span>Exercices</button>
  <button class="nb" id="nb-log" onclick="goPage('log')"><span class="nb-icon">â•</span>SÃ©ance</button>
  <button class="nb" id="nb-hist" onclick="goPage('hist')"><span class="nb-icon">ğŸ“‹</span>Historique</button>
  <button class="nb" id="nb-prog" onclick="goPage('prog')"><span class="nb-icon">ğŸ“ˆ</span>Ã‰volution</button>
  <div class="nav-sp"></div>
  <div class="save-dot" title="DonnÃ©es sauvegardÃ©es"></div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â• NAV MOBILE BOTTOM â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="mob-nav">
  <button class="mob-nav-btn on" id="mnb-dash" onclick="goPage('dash')">
    <span class="mn-icon">ğŸ </span><span>Home</span>
  </button>
  <button class="mob-nav-btn" id="mnb-lib" onclick="goPage('lib')">
    <span class="mn-icon">ğŸ“š</span><span>Exercices</span>
  </button>
  <button class="mob-nav-btn mob-nav-btn-center" id="mnb-log" onclick="goPage('log')">
    <span class="mn-icon">â•</span>
    <span>SÃ©ance</span>
  </button>
  <button class="mob-nav-btn" id="mnb-hist" onclick="goPage('hist')">
    <span class="mn-icon">ğŸ“‹</span><span>Historique</span>
  </button>
  <button class="mob-nav-btn" id="mnb-prog" onclick="goPage('prog')">
    <span class="mn-icon">ğŸ“ˆ</span><span>Stats</span>
  </button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-dash" class="pg on">
  <div class="flex-bc" style="margin-bottom:4px">
    <div class="page-title" id="dash-title">TABLEAU DE BORD</div>
    <div id="dash-streak-badge"></div>
  </div>
  <p class="page-sub" id="dash-sub">Chargementâ€¦</p>
  <div class="stats-row" id="dash-stats"></div>
  <div class="g2" style="margin-bottom:12px">
    <div class="chart-box"><div class="chart-hd">ğŸ”¥ Calories Â· 7 jours</div><div class="bars" id="d-cal-bars"></div><div style="display:flex;gap:4px;margin-top:4px" id="d-cal-xl"></div></div>
    <div class="chart-box"><div class="chart-hd">ğŸ’ª Volume Â· 7 jours</div><div class="bars" id="d-vol-bars"></div><div style="display:flex;gap:4px;margin-top:4px" id="d-vol-xl"></div></div>
  </div>
  <div class="dash-extras">
    <div class="chart-box dash-quote-card">
      <div class="chart-hd" style="margin-bottom:8px">ğŸ’¬ Motivation</div>
      <div class="quote-bar"><div class="quote-icon">âš¡</div><div><div class="quote-text" id="dash-quote"></div><div class="quote-author" id="dash-quote-author"></div></div></div>
    </div>
    <div class="chart-box dash-water-card">
      <div class="chart-hd" style="margin-bottom:8px">ğŸ’§ Eau</div>
      <div style="font-size:.72rem;color:var(--txt3);margin-bottom:8px"><span id="water-count">0</span>/8 verres</div>
      <div class="water-track" id="water-track"></div>
      <button onclick="resetWater()" style="margin-top:6px;font-size:.65rem;color:var(--txt3);background:none;border:none;cursor:pointer;text-decoration:underline">Reset</button>
    </div>
  </div>
  <div class="sec">DerniÃ¨res sÃ©ances</div>
  <div id="dash-recent"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• LIBRARY â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-lib" class="pg">
  <div class="flex-bc" style="margin-bottom:4px">
    <div class="page-title">EXERCICES</div>
    <button class="btn btn-teal btn-sm" onclick="openCustomModal()">âœï¸ CrÃ©er exercice</button>
  </div>
  <p class="page-sub" id="lib-count">Chargementâ€¦</p>
  <div class="search-wrap"><input type="text" id="lib-q" placeholder="Rechercher exercice, muscle, catÃ©gorieâ€¦" oninput="renderLib()"></div>
  <div class="filters" id="lib-flt"></div>
  <div class="ex-grid" id="lib-grid"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• LOG SÃ‰ANCE â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-log" class="pg">
  <div class="flex-bc" style="margin-bottom:4px">
    <div class="page-title">NOUVELLE SÃ‰ANCE</div>
    <button class="btn btn-ghost btn-sm" onclick="openTemplateModal()">ğŸ“‹ Templates</button>
  </div>
  <p class="page-sub">Enregistre ton entraÃ®nement du jour</p>

  <!-- Session type -->
  <div class="session-type-pick">
    <button class="stp on lime" id="stp-strength" onclick="setSessionType('strength')">ğŸ‹ï¸ Musculation</button>
    <button class="stp" id="stp-cardio" onclick="setSessionType('cardio')">ğŸƒ Cardio</button>
    <button class="stp" id="stp-mixed" onclick="setSessionType('mixed')">âš¡ Mixte</button>
  </div>

  <div class="fgrid card" style="margin-bottom:12px">
    <div class="fg"><label>Nom de la sÃ©ance</label><input type="text" id="log-name" placeholder="Push Day, Full Body HIITâ€¦"></div>
    <div class="fg"><label>Date</label><input type="date" id="log-date"></div>
    <div class="triple">
      <div class="fg"><label>DurÃ©e (min)</label><input type="number" id="log-dur" placeholder="60" min="1" max="300"></div>
      <div class="fg"><label>IntensitÃ©</label>
        <select id="log-intensity">
          <option value="1">ğŸ˜´ LÃ©gÃ¨re</option>
          <option value="1.2" selected>ğŸ’ª ModÃ©rÃ©e</option>
          <option value="1.4">ğŸ”¥ Intense</option>
          <option value="1.6">ğŸ’€ Maximale</option>
        </select>
      </div>
      <div class="fg"><label>Poids corpo (kg)</label><input type="number" id="log-bw" placeholder="80" min="30" max="200" step="0.5"></div>
    </div>
    <div class="fg full"><label>Note / ressenti</label><textarea id="log-note" placeholder="Bonne sÃ©ance, PR sur le squat, fatigue musculaireâ€¦" rows="2"></textarea></div>
  </div>

  <!-- Cardio section (shown for cardio/mixed) -->
  <div id="cardio-section" style="display:none">
    <div class="sec">ğŸƒ ActivitÃ©s cardio</div>
    <div id="cardio-ex-list"></div>
    <button class="btn btn-ghost btn-full" style="margin-bottom:12px" onclick="openAddExModal('cardio')">ï¼‹ Ajouter activitÃ© cardio</button>
  </div>

  <!-- Strength section (shown for strength/mixed) -->
  <div id="strength-section">
    <div class="sec">ğŸ‹ï¸ Exercices de force</div>
    <div id="strength-ex-list"></div>
    <button class="btn btn-ghost btn-full" style="margin-bottom:12px" onclick="openAddExModal('strength')">ï¼‹ Ajouter exercice</button>
  </div>

  <div class="summary-bar" id="log-summary">
    <div class="sum-grid">
      <div class="sum-item"><div class="sum-lbl">Calories</div><div class="sum-val" id="sum-cal">0</div></div>
      <div class="sum-item"><div class="sum-lbl">Volume (kg)</div><div class="sum-val" id="sum-vol">0</div></div>
      <div class="sum-item"><div class="sum-lbl">SÃ©ries</div><div class="sum-val" id="sum-sets">0</div></div>
      <div class="sum-item"><div class="sum-lbl">Exercices</div><div class="sum-val" id="sum-exs">0</div></div>
    </div>
  </div>

  <div style="display:flex;gap:10px;margin-top:12px">
    <button class="btn btn-ghost" onclick="clearLog()" style="flex:0 0 auto">ğŸ—‘ Effacer</button>
    <button class="btn btn-lime btn-full" onclick="saveWorkout()">ğŸ’¾ Enregistrer la sÃ©ance</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• HISTORY â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-hist" class="pg">
  <div class="flex-bc" style="margin-bottom:4px">
    <div class="page-title">HISTORIQUE</div>
    <input type="text" id="hist-q" placeholder="ğŸ” Rechercherâ€¦" style="background:var(--ink3);border:1px solid var(--rim);border-radius:var(--r8);padding:6px 12px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:.82rem;outline:none;width:160px" oninput="renderHist()">
  </div>
  <p class="page-sub" id="hist-count"></p>
  <div id="hist-list"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• PROGRESS â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-prog" class="pg">
  <div class="page-title">Ã‰VOLUTION</div>
  <p class="page-sub">Ta progression sur le long terme</p>
  <div class="tab-bar">
    <button class="tbtn on" id="tb-stats" onclick="switchTab('stats')">ğŸ“Š Stats</button>
    <button class="tbtn" id="tb-weight" onclick="switchTab('weight')">âš–ï¸ Poids</button>
    <button class="tbtn" id="tb-body" onclick="switchTab('body')">ğŸ“ Mensurations</button>
    <button class="tbtn" id="tb-muscles" onclick="switchTab('muscles')">ğŸ’ª Muscles</button>
    <button class="tbtn" id="tb-prs" onclick="switchTab('prs')">ğŸ† Records</button>
  </div>
  <div id="prog-content"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Exercise Detail -->
<div class="overlay" id="ov-detail">
  <div class="modal modal-lg">
    <div class="mhd">
      <div style="flex:1">
        <div id="det-name" style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:1px;margin-bottom:6px"></div>
        <div id="det-tags" style="display:flex;gap:5px;flex-wrap:wrap"></div>
      </div>
      <button class="mclose" onclick="closeOv('ov-detail')">âœ•</button>
    </div>
    <div class="det-img" id="det-img"></div>
    <p id="det-desc" style="color:var(--txt2);font-size:.86rem;line-height:1.75;margin-bottom:14px"></p>
    <div class="det-stats-row" id="det-stats"></div>
    <div class="sec" style="margin-top:0">Muscles ciblÃ©s</div>
    <div class="det-muscles" id="det-mus"></div>
    <div class="sec">Conseils d'exÃ©cution</div>
    <div class="tips-list" id="det-tips"></div>
    <div id="det-custom-actions" style="display:flex;gap:8px;margin-bottom:12px"></div>
    <button class="btn btn-lime btn-full" id="det-add-btn" onclick="addExFromDetail()">â• Ajouter Ã  la sÃ©ance</button>
  </div>
</div>

<!-- Add exercise to log -->
<div class="overlay" id="ov-add">
  <div class="modal modal-md">
    <div class="mhd"><div><strong>Ajouter un exercice</strong><div id="ov-add-sub" style="font-size:.78rem;color:var(--txt2);margin-top:2px"></div></div><button class="mclose" onclick="closeOv('ov-add')">âœ•</button></div>
    <div class="search-wrap"><input type="text" id="add-q" placeholder="ğŸ” Rechercherâ€¦" oninput="renderAddList()"></div>
    <div class="filters" id="add-flt"></div>
    <div id="add-list" style="max-height:420px;overflow-y:auto"></div>
  </div>
</div>

<!-- Custom exercise -->
<div class="overlay" id="ov-custom">
  <div class="modal modal-md">
    <div class="mhd"><strong id="custom-title">âœï¸ Nouvel exercice</strong><button class="mclose" onclick="closeOv('ov-custom')">âœ•</button></div>
    <div class="ce-preview" id="ce-preview">ğŸ‹ï¸</div>
    <div class="fgrid">
      <div class="fg full"><label>Nom *</label><input type="text" id="ce-name" placeholder="Ex: Jefferson Squat, Sissy Squatâ€¦"></div>
      <div class="fg"><label>CatÃ©gorie *</label>
        <select id="ce-cat">
          <option>Poitrine</option><option>Dos</option><option>Ã‰paules</option><option>Bras</option>
          <option>Jambes</option><option>Fessiers</option><option>Core</option>
          <option>Cardio</option><option>Crossfit</option><option>Autre</option>
        </select>
      </div>
      <div class="fg"><label>Type</label>
        <select id="ce-type">
          <option>Musculation</option><option>Kettlebell</option><option>Poids du corps</option>
          <option>Cardio</option><option>HIIT</option><option>Ã‰tirement</option>
        </select>
      </div>
      <div class="fg"><label>MET (intensitÃ©)</label>
        <select id="ce-met">
          <option value="3">3 â€” LÃ©ger (yoga, stretching)</option>
          <option value="4">4 â€” ModÃ©rÃ© lÃ©ger</option>
          <option value="5" selected>5 â€” ModÃ©rÃ© (muscu lÃ©gÃ¨re)</option>
          <option value="6">6 â€” ModÃ©rÃ© intense</option>
          <option value="7">7 â€” Intense (muscu lourde)</option>
          <option value="8">8 â€” TrÃ¨s intense</option>
          <option value="10">10 â€” HIIT / Kettlebell</option>
          <option value="12">12 â€” Sprint / Burpees</option>
        </select>
      </div>
      <div class="fg"><label>IcÃ´ne emoji</label><input type="text" id="ce-icon" placeholder="ğŸ‹ï¸" maxlength="4" oninput="updateCePreview()"></div>
      <div class="fg full"><label>Muscles (sÃ©parÃ©s par virgule)</label><input type="text" id="ce-muscles" placeholder="Pectoraux, Triceps, Ã‰paulesâ€¦"></div>
      <div class="fg full"><label>Description</label><textarea id="ce-desc" placeholder="Comment bien exÃ©cuter cet exerciceâ€¦" rows="3"></textarea></div>
      <div class="fg full"><label>Conseils (un par ligne)</label><textarea id="ce-tips" placeholder="Garder le dos droit&#10;ContrÃ´ler la phase excentrique&#10;Expirer Ã  l'effort" rows="3"></textarea></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-lime" style="flex:1" onclick="saveCustomEx()">ğŸ’¾ Sauvegarder</button>
      <button class="btn btn-ghost" onclick="closeOv('ov-custom')">Annuler</button>
    </div>
  </div>
</div>

<!-- Workout detail -->
<div class="overlay" id="ov-wo">
  <div class="modal modal-lg">
    <div class="mhd">
      <div><div id="wo-det-name" style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:1px;margin-bottom:3px"></div><div id="wo-det-meta" style="font-size:.78rem;color:var(--txt2)"></div></div>
      <button class="mclose" onclick="closeOv('ov-wo')">âœ•</button>
    </div>
    <div class="det-stats-row" id="wo-det-stats"></div>
    <div id="wo-det-body"></div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-ghost" style="flex:1" onclick="duplicateWo()">ğŸ“‹ Dupliquer</button>
      <button class="btn btn-teal btn-sm" onclick="reloadWoToLog()">ğŸ”„ Re-faire</button>
      <button class="btn btn-red btn-sm" onclick="triggerDeleteWo()">ğŸ—‘ Supprimer</button>
    </div>
  </div>
</div>

<!-- Confirm -->
<div class="overlay" id="ov-confirm">
  <div class="confirm-box">
    <h3 id="cfm-title">Supprimer ?</h3>
    <p id="cfm-msg">Action irrÃ©versible.</p>
    <div style="display:flex;gap:8px">
      <button class="btn btn-red" onclick="doConfirm()">Confirmer</button>
      <button class="btn btn-ghost" onclick="closeOv('ov-confirm')">Annuler</button>
    </div>
  </div>
</div>

<!-- Templates Modal -->
<div class="overlay" id="ov-templates">
  <div class="modal modal-md">
    <div class="mhd"><strong>ğŸ“‹ Templates de sÃ©ance</strong><button class="mclose" onclick="closeOv('ov-templates')">âœ•</button></div>
    <div id="tpl-list" style="max-height:440px;overflow-y:auto"></div>
    <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--rim)">
      <button class="btn btn-teal btn-full" onclick="saveAsTemplate()">ğŸ’¾ Sauvegarder sÃ©ance actuelle comme template</button>
    </div>
  </div>
</div>

<!-- Rest Timer -->
<div class="rest-timer" id="rest-timer">
  <div class="rt-title">â± REPOS</div>
  <div class="rt-time" id="rt-display">2:00</div>
  <div class="rt-bar"><div class="rt-fill" id="rt-fill" style="width:100%"></div></div>
  <div class="rt-btns">
    <button class="btn btn-ghost btn-sm" onclick="addRestTime(30)">+30s</button>
    <button class="btn btn-ghost btn-sm" onclick="skipRest()">Skip â©</button>
    <button class="btn btn-red btn-sm" onclick="closeRest()">âœ•</button>
  </div>
</div>

<div class="toast" id="toast"></div>


<div class="toast" id="toast"></div>

<!-- PWA Install Banner -->


<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   CONSTANTS & UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DB = 'bibzhit_v1';
let db = {workouts:[], poids:[], measures:[], custom:[], templates:[], water:{}, lastSave:null};

// MET values for exercises (kcal = MET Ã— weight(kg) Ã— duration(h))
// For strength: we use a per-rep formula instead: kcal â‰ˆ sets Ã— reps Ã— weight Ã— 0.00015 + MET-based base

const QUOTES = [
  {text:"Le succÃ¨s n'est pas final, l'Ã©chec n'est pas fatal : c'est le courage de continuer qui compte.",author:"Winston Churchill"},
  {text:"La douleur que tu ressens aujourd'hui sera la force que tu ressentiras demain.",author:"Anonyme"},
  {text:"Ton corps peut supporter presque n'importe quoi. C'est ton esprit que tu dois convaincre.",author:"Anonyme"},
  {text:"Ne compte pas les jours, fais que les jours comptent.",author:"Muhammad Ali"},
  {text:"La discipline est le pont entre les objectifs et les accomplissements.",author:"Jim Rohn"},
  {text:"Ce n'est pas la taille du chien dans le combat, c'est la taille du combat dans le chien.",author:"Mark Twain"},
  {text:"Les champions ne sont pas faits dans les salles de sport. Les champions sont faits de quelque chose qu'ils ont au fond d'eux : un dÃ©sir, un rÃªve, une vision.",author:"Muhammad Ali"},
  {text:"Le seul mauvais entraÃ®nement est celui que tu n'as pas fait.",author:"Anonyme"},
  {text:"Deviens plus fort que tes excuses.",author:"Anonyme"},
  {text:"Le corps atteint ce que l'esprit croit.",author:"Napoleon Hill"},
  {text:"Chaque rep est un vote pour la personne que tu veux devenir.",author:"James Clear"},
  {text:"La sueur d'aujourd'hui est la victoire de demain.",author:"Anonyme"},
];

const C = {
  MET_DEFAULT: 5,
  REST_DEFAULT: 90,  // seconds
  LIME: '#c6ff00',
  ORANGE: '#ff8c00',
  TEAL: '#00e5cc',
  RED: '#ff3b3b',
  BLUE: '#3b8bff',
};

function save() {
  db.lastSave = new Date().toISOString();
  try { localStorage.setItem(DB, JSON.stringify(db)); } 
  catch(e) { showToast('âš ï¸ Erreur de sauvegarde', 'err'); }
}
function load() {
  try { const s = localStorage.getItem(DB); if(s) db = {...db, ...JSON.parse(s)}; }
  catch(e) { console.warn('load error', e); }
}

window.addEventListener('beforeunload', save);
document.addEventListener('visibilitychange', () => { if(document.hidden) save(); });

function fDate(d) { return new Date(d).toLocaleDateString('fr-FR',{day:'numeric',month:'short',year:'numeric'}); }
function fMonth(ym) { const [y,m]=ym.split('-'); return new Date(y,m-1).toLocaleDateString('fr-FR',{month:'long',year:'numeric'}); }
function today() { return new Date().toISOString().split('T')[0]; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   EXERCISE DATABASE â€” with Unsplash images & real MET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Calories per SET formula (strength): base_kcal = MET * sets_duration_min / 60 * bw
// We use simplified: cal_per_set = MET * 0.5min * bw/60 = MET*bw/120
// For display we store MET and compute live based on user bodyweight

const EX_DB = [
  // â”€â”€â”€ POITRINE â”€â”€â”€
  {id:1,name:"DÃ©veloppÃ© couchÃ© barre",cat:"Poitrine",type:"Musculation",
   met:5.5,muscles:["Pectoraux","Triceps","DeltoÃ¯des ant."],
   img:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&q=80",
   desc:"Exercice roi de la poitrine. AllongÃ© sur banc horizontal, saisir la barre en prise pronation lÃ©gÃ¨rement plus large que les Ã©paules. Descendre lentement jusqu'Ã  effleurer la poitrine, puis pousser explosif vers le haut.",
   tips:["Omoplates rÃ©tractÃ©es et dÃ©primÃ©es pendant tout le mouvement","Arche lombaire naturelle, pieds Ã  plat au sol","Wrist wrap si douleur au poignet","Descente 3s, pause 1s, montÃ©e 1s pour hypertrophie"]},
  {id:2,name:"DÃ©veloppÃ© couchÃ© haltÃ¨res",cat:"Poitrine",type:"Musculation",
   met:5.5,muscles:["Pectoraux","Triceps","Stabilisateurs"],
   img:"https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=400&q=80",
   desc:"Amplitude supÃ©rieure Ã  la barre. Les haltÃ¨res permettent une rotation des poignets et un Ã©tirement profond des pectoraux en position basse.",
   tips:["Rotation des poignets vers l'intÃ©rieur en remontant","Ne jamais laisser les coudes tomber en dessous des Ã©paules","ContrÃ´le total de la descente"]},
  {id:3,name:"DÃ©veloppÃ© inclinÃ©",cat:"Poitrine",type:"Musculation",
   met:5.5,muscles:["Pectoraux sup.","Triceps","Ã‰paules"],
   img:"https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?w=400&q=80",
   desc:"Banc inclinÃ© 30â€“45Â°. Cible les faisceaux supÃ©rieurs des pectoraux, crÃ©ant un galbe sous la clavicule. Indispensable pour une poitrine complÃ¨te.",
   tips:["Inclinaison max 45Â° pour rester sur les pecs (au-delÃ  = Ã©paules)","Prise lÃ©gÃ¨rement plus Ã©troite qu'au dÃ©veloppÃ© plat"]},
  {id:4,name:"Dips lestÃ©s",cat:"Poitrine",type:"Musculation",
   met:6.5,muscles:["Pectoraux inf.","Triceps","Avant-bras"],
   img:"https://images.unsplash.com/photo-1598971457999-ca4ef48a9a71?w=400&q=80",
   desc:"Aux barres parallÃ¨les, se pencher en avant Ã  ~30Â° pour cibler les pectoraux infÃ©rieurs. Le lestage permet une progression continue.",
   tips:["Pencher le buste vers l'avant (plus de poitrine)","Descendre jusqu'Ã  l'Ã©tirement complet","SÃ©curiser le lest avec une ceinture dÃ©diÃ©e"]},
  {id:5,name:"Pompes",cat:"Poitrine",type:"Poids du corps",
   met:8,muscles:["Pectoraux","Triceps","Core","Ã‰paules"],
   img:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&q=80",
   desc:"Le fondamental du poids de corps. Corps parfaitement gainÃ©, mains lÃ©gÃ¨rement plus larges que les Ã©paules. Infiniment modulable.",
   tips:["Corps alignÃ© tÃªte-talons (planche parfaite)","Coudes Ã  45Â° du tronc","Variantes: pieds surÃ©levÃ©s, lestÃ©es, archer, diamond"]},
  {id:6,name:"Ã‰cartÃ© cÃ¢bles croisÃ©s",cat:"Poitrine",type:"Musculation",
   met:4,muscles:["Pectoraux","DeltoÃ¯des ant."],
   img:"https://images.unsplash.com/photo-1576678927484-cc907957088c?w=400&q=80",
   desc:"Isolation parfaite des pectoraux avec tension constante du cÃ¢ble. Contrairement aux haltÃ¨res, le cÃ¢ble maintient la rÃ©sistance en position fermÃ©e.",
   tips:["LÃ©gÃ¨re flexion des coudes tout au long","Penser 'entourer un arbre'","Contraction maximale au centre, pause 1s"]},

  // â”€â”€â”€ DOS â”€â”€â”€
  {id:7,name:"Traction pronation",cat:"Dos",type:"Poids du corps",
   met:8,muscles:["Grand dorsal","Biceps","RhomboÃ¯des","TrapÃ¨zes inf."],
   img:"https://images.unsplash.com/photo-1605296867304-46d5465a13f1?w=400&q=80",
   desc:"Le roi du haut du dos. Prise pronation plus large que les Ã©paules. Tirer les coudes vers les hanches, poitrine vers la barre. Retour complet bras tendus.",
   tips:["DÃ©marrer en rÃ©tractant les omoplates avant de tirer","Ne jamais se balancer â€” slow negatives","Progression: lestÃ©es > prise neutre > anneau > archer"]},
  {id:8,name:"SoulevÃ© de terre",cat:"Dos",type:"Musculation",
   met:7.5,muscles:["Lombaires","Fessiers","TrapÃ¨zes","Quadriceps","Ischio"],
   img:"https://images.unsplash.com/photo-1517838277536-f5f99be501cd?w=400&q=80",
   desc:"Le mouvement le plus complet en musculation. Active 60%+ des muscles du corps. Barre contre les tibias, dos neutre, pousser le sol vers le bas.",
   tips:["Barre reste en contact avec les jambes tout au long","Verrouiller les hanches et les genoux simultanÃ©ment","Ne jamais arrondir le bas du dos","Ceinture pour les charges maximales uniquement"]},
  {id:9,name:"Rowing barre Pendlay",cat:"Dos",type:"Musculation",
   met:6,muscles:["RhomboÃ¯des","Grand dorsal","Biceps","TrapÃ¨zes moy."],
   img:"https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=400&q=80",
   desc:"Barre au sol entre chaque rÃ©pÃ©tition. Dos horizontal (90Â°). Mouvement explosif vers le haut. DÃ©veloppe l'Ã©paisseur du dos comme aucun autre exercice.",
   tips:["Dos strictement horizontal pendant tout le mouvement","Tirer vers le bas de l'abdomen","Laisser la barre revenir complÃ¨tement au sol"]},
  {id:10,name:"Tirage vertical poulie",cat:"Dos",type:"Musculation",
   met:5,muscles:["Grand dorsal","Biceps","RhomboÃ¯des"],
   img:"https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=400&q=80",
   desc:"Lat pulldown. Excellent pour dÃ©velopper la largeur du dos et l'isolation du grand dorsal. Tirer vers le haut de la poitrine, coudes dans l'axe.",
   tips:["Ne pas s'incliner excessivement en arriÃ¨re","Finir avec les coudes vers les hanches","Prise large = dos, prise Ã©troite = biceps"]},
  {id:11,name:"SoulevÃ© de terre Roumain",cat:"Dos",type:"Musculation",
   met:6,muscles:["Ischio-jambiers","Lombaires","Fessiers","Ã‰recteurs"],
   img:"https://images.unsplash.com/photo-1574680096145-d05b474e2155?w=400&q=80",
   desc:"Jambes tendues (lÃ©gÃ¨rement flÃ©chies), descendre la barre le long des tibias en poussant les hanches en arriÃ¨re. Stretch intense des ischio-jambiers.",
   tips:["Hanches en arriÃ¨re, pas genoux qui flÃ©chissent","Sentir l'Ã©tirement dans les ischio avant de remonter","Barre proche du corps tout au long"]},
  {id:12,name:"Face pull",cat:"Dos",type:"Musculation",
   met:4,muscles:["DeltoÃ¯des post.","RhomboÃ¯des","Rotateurs ext."],
   img:"https://images.unsplash.com/photo-1532029837206-abbe2b7620e3?w=400&q=80",
   desc:"CÃ¢ble ou bande, tirer vers le visage avec les coudes hauts. Exercice de santÃ© des Ã©paules indispensable pour contrer les effets du travail de bureau.",
   tips:["Coudes Ã  hauteur des oreilles ou au-dessus","Rotation externe maximale en fin de mouvement","Poids lÃ©ger, technique parfaite â€” 15â€“20 reps"]},

  // â”€â”€â”€ Ã‰PAULES â”€â”€â”€
  {id:13,name:"DÃ©veloppÃ© militaire",cat:"Ã‰paules",type:"Musculation",
   met:6,muscles:["DeltoÃ¯des","Triceps","TrapÃ¨zes","Core"],
   img:"https://images.unsplash.com/photo-1583454155184-870a1f63aebc?w=400&q=80",
   desc:"Pousser la barre verticalement au-dessus de la tÃªte. Debout = plus de core. L'exercice de force pure pour les Ã©paules, implique tout le corps.",
   tips:["Gainage abdominal maximal pendant tout le mouvement","Ne pas cambrer le bas du dos","TÃªte en arriÃ¨re pour laisser passer la barre, puis rentre dedans en haut"]},
  {id:14,name:"Ã‰lÃ©vations latÃ©rales",cat:"Ã‰paules",type:"Musculation",
   met:3.5,muscles:["DeltoÃ¯des latÃ©raux"],
   img:"https://images.unsplash.com/photo-1581009137042-c552e485697a?w=400&q=80",
   desc:"Isolation pure du faisceau latÃ©ral (mÃ©dian) du deltoÃ¯de. Responsable de la largeur des Ã©paules. LÃ©ger en poids, parfait en exÃ©cution.",
   tips:["LÃ©gÃ¨re inclinaison du torse vers l'avant (~10Â°)","Petit doigt lÃ©gÃ¨rement en l'air","Ne jamais aller au-delÃ  de l'horizontale","Drop sets trÃ¨s efficaces ici"]},
  {id:15,name:"Ã‰lÃ©vations frontales",cat:"Ã‰paules",type:"Musculation",
   met:3.5,muscles:["DeltoÃ¯des ant.","Claviculaire"],
   img:"https://images.unsplash.com/photo-1577221084712-45b0445d2b00?w=400&q=80",
   desc:"Lever les bras vers l'avant jusqu'Ã  l'horizontale. Cible le faisceau antÃ©rieur du deltoÃ¯de, souvent over-dÃ©veloppÃ© par le dÃ©veloppÃ© couchÃ©.",
   tips:["Alternez gauche/droite pour plus de contrÃ´le","Poignets neutres en supination","Rarement nÃ©cessaire si vous faites beaucoup de dÃ©veloppÃ©"]},
  {id:16,name:"Arnold Press",cat:"Ã‰paules",type:"Musculation",
   met:5.5,muscles:["DeltoÃ¯des (3 faisceaux)","Triceps"],
   img:"https://images.unsplash.com/photo-1533560904424-a0c61dc306fc?w=400&q=80",
   desc:"InventÃ© par Schwarzenegger. Rotation des paumes de l'intÃ©rieur vers l'extÃ©rieur pendant la montÃ©e, activant les 3 faisceaux du deltoÃ¯de en sÃ©quence.",
   tips:["Partir paumes face Ã  soi, haltÃ¨res devant la poitrine","Rotation progressive pendant la montÃ©e","Amplitude complÃ¨te â€” coudes bien Ã©tendus en haut"]},

  // â”€â”€â”€ BRAS â”€â”€â”€
  {id:17,name:"Curl biceps barre EZ",cat:"Bras",type:"Musculation",
   met:3,muscles:["Biceps brachial","Brachial","Avant-bras"],
   img:"https://images.unsplash.com/photo-1581009137042-c552e485697a?w=400&q=80",
   desc:"La barre EZ rÃ©duit le stress sur les poignets comparÃ© Ã  la barre droite. Isolation classique des biceps, coudes strictement fixes.",
   tips:["Coudes collÃ©s au corps, ne bougent pas","Supination maximale en haut (petits doigts vers l'extÃ©rieur)","ContrÃ´le de la phase excentrique (descente 3s)"]},
  {id:18,name:"Curl marteau",cat:"Bras",type:"Musculation",
   met:3,muscles:["Brachial","Biceps brachial","Brachioradial"],
   img:"https://images.unsplash.com/photo-1530822847156-5df684ec5933?w=400&q=80",
   desc:"Prise neutre (pouce vers le haut). DÃ©veloppe le brachial sous le biceps, ajoutant de l'Ã©paisseur au bras. Souvent nÃ©gligÃ©, pourtant crucial.",
   tips:["Prise neutre maintenue tout au long","Peut se faire alternÃ© ou simultanÃ©","Cross-body hammer pour cibler encore plus le brachial"]},
  {id:19,name:"Extension triceps poulie",cat:"Bras",type:"Musculation",
   met:3.5,muscles:["Triceps (3 chefs)"],
   img:"https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?w=400&q=80",
   desc:"Pushdown Ã  la poulie haute avec corde ou barre. Excellent isolateur des triceps. La corde permet une rotation des poignets en bas pour maximiser la contraction.",
   tips:["Coudes fixes contre les cÃ´tes","Ouvrir les mains avec la corde en bas (plus d'activation)","Contraction maximale Ã  chaque rÃ©pÃ©tition"]},
  {id:20,name:"Barre au front",cat:"Bras",type:"Musculation",
   met:4.5,muscles:["Triceps (chef long)","Triceps latÃ©ral"],
   img:"https://images.unsplash.com/photo-1550259979-ed79b48d2a30?w=400&q=80",
   desc:"Skull crusher. AllongÃ© sur banc, flÃ©chir uniquement les coudes pour descendre la barre vers le front. Masse le chef long du triceps.",
   tips:["Coudes pointÃ©s vers le plafond, ne s'Ã©cartent pas","Alternative: descendre derriÃ¨re la tÃªte (plus de stretch)","Charge modÃ©rÃ©e, technique parfaite"]},

  // â”€â”€â”€ JAMBES â”€â”€â”€
  {id:21,name:"Squat barre",cat:"Jambes",type:"Musculation",
   met:6,muscles:["Quadriceps","Fessiers","Ischio","Lombaires","Core"],
   img:"https://images.unsplash.com/photo-1574680178050-55c6a6a96e0a?w=400&q=80",
   desc:"Le roi des exercices. Active plus de 200 muscles. Barre haute ou basse selon morphologie. Descendre cuisses parallÃ¨les ou plus bas selon mobilitÃ©.",
   tips:["Genoux dans l'axe des orteils, ne jamais en dedans","Talons au sol pendant toute l'exÃ©cution","Regard lÃ©gÃ¨rement au-dessus de l'horizon","Respiration: inspirer en bas, expirer en montant"]},
  {id:22,name:"Leg press",cat:"Jambes",type:"Musculation",
   met:5,muscles:["Quadriceps","Fessiers","Ischio"],
   img:"https://images.unsplash.com/photo-1540497077202-7c8a3999166f?w=400&q=80",
   desc:"Machine Ã  45Â°. Le placement des pieds change les muscles ciblÃ©s. Pieds hauts = fessiers/ischio. Pieds bas = quadriceps. Charge Ã©levÃ©e possible.",
   tips:["Ne jamais verrouiller complÃ¨tement les genoux","Amplitude complÃ¨te = rÃ©sultats optimaux","Dos collÃ© au dossier tout au long"]},
  {id:23,name:"Fentes marchÃ©es",cat:"Jambes",type:"Musculation",
   met:5,muscles:["Quadriceps","Fessiers","Ischio","Mollets"],
   img:"https://images.unsplash.com/photo-1434682881908-b43d0467b798?w=400&q=80",
   desc:"Grand pas en avant, genou arriÃ¨re vers le sol, se propulser pour avancer. DÃ©veloppement unilatÃ©ral et Ã©quilibre. Avec barre, haltÃ¨res ou lest.",
   tips:["Torse vertical pendant tout le mouvement","Genou avant reste au-dessus de la cheville (90Â°)","Descendre lentement, monter fort"]},
  {id:24,name:"Hip Thrust",cat:"Fessiers",type:"Musculation",
   met:5,muscles:["Grand fessier","Ischio-jambiers","Core"],
   img:"https://images.unsplash.com/photo-1571731956672-f2b94d7dd0cb?w=400&q=80",
   desc:"Le meilleur exercice d'activation des fessiers. Ã‰paules sur banc, barre sur les hanches. Extension complÃ¨te des hanches avec contraction maximale.",
   tips:["Menton rentrÃ© sur la poitrine (regard vers le nombril)","Pied Ã  plat, genoux Ã  90Â° en haut","Contraction maximale en haut â€” tenir 1s","Pad de mousse obligatoire pour le confort"]},
  {id:25,name:"Leg curl couchÃ©",cat:"Jambes",type:"Musculation",
   met:4,muscles:["Ischio-jambiers","GastrocnÃ©mien"],
   img:"https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?w=400&q=80",
   desc:"Machine de curl allongÃ©. Isolation parfaite des ischio-jambiers. Souvent nÃ©gligÃ© mais crucial pour l'Ã©quilibre musculaire et prÃ©venir les blessures.",
   tips:["Amplitude complÃ¨te â€” jambes tendues Ã  jambes maximalement flÃ©chies","ContrÃ´le de la descente (excentrique)","Pas de tricherie avec les hanches"]},
  {id:26,name:"Extension quadriceps",cat:"Jambes",type:"Musculation",
   met:4,muscles:["Quadriceps (4 chefs)"],
   img:"https://images.unsplash.com/photo-1540497077202-7c8a3999166f?w=400&q=80",
   desc:"Machine d'extension. Isolation des quadriceps. Contracter en haut, descendre lentement. Excellente finition aprÃ¨s squats.",
   tips:["Contraction maximale en extension","Pause 1â€“2s en haut","UnilatÃ©ral pour corriger les dÃ©sÃ©quilibres"]},
  {id:27,name:"Mollets Ã  la machine",cat:"Jambes",type:"Musculation",
   met:4,muscles:["GastrocnÃ©mien","SolÃ©aire"],
   img:"https://images.unsplash.com/photo-1571019613576-2b22c76fd955?w=400&q=80",
   desc:"Extension plantaire complÃ¨te sur machine ou step. Les mollets rÃ©cupÃ¨rent vite â†’ volume Ã©levÃ© (15â€“25 reps) et frÃ©quence haute (3â€“4x/semaine).",
   tips:["Amplitude COMPLÃˆTE â€” stretch total en bas","Pause 2s en bas pour Ã©tirement max","Debout = gastrocnÃ©mien, assis = solÃ©aire"]},
  {id:28,name:"Goblet squat",cat:"Jambes",type:"Musculation",
   met:5,muscles:["Quadriceps","Fessiers","Core","Dorsaux"],
   img:"https://images.unsplash.com/photo-1574680178050-55c6a6a96e0a?w=400&q=80",
   desc:"HaltÃ¨re ou kettlebell tenu contre la poitrine. Excellent pour apprendre la mÃ©canique du squat profond et renforcer le core simultanÃ©ment.",
   tips:["Coudes entre les genoux en position basse","Talons au sol, profondeur maximale","Parfait comme Ã©chauffement avant squat barre"]},

  // â”€â”€â”€ CORE â”€â”€â”€
  {id:29,name:"Planche (Gainage)",cat:"Core",type:"Poids du corps",
   met:4,muscles:["Abdominaux","Lombaires","Ã‰paules","Fessiers"],
   img:"https://images.unsplash.com/photo-1566241440091-ec10de8db2e1?w=400&q=80",
   desc:"Position isomÃ©trique sur avant-bras. Travaille tout le tronc simultanÃ©ment. La base de tout gainage solide. Peut se progresser vers des variantes dynamiques.",
   tips:["Corps parfaitement alignÃ© â€” ni hanches en l'air ni en bas","Contraction abdominale et fessiÃ¨re constante","Respiration normale et contrÃ´lÃ©e","Variantes: latÃ©rale, rouleau, sur mains"]},
  {id:30,name:"RelevÃ© de jambes suspendu",cat:"Core",type:"Poids du corps",
   met:5,muscles:["Abdominaux inf.","FlÃ©chisseurs hanches","Rectus abdominis"],
   img:"https://images.unsplash.com/photo-1605296867304-46d5465a13f1?w=400&q=80",
   desc:"Suspendu Ã  une barre, monter les jambes tendues Ã  l'horizontale ou en L. L'un des meilleurs exercices pour le bas des abdominaux.",
   tips:["Mouvement lent et contrÃ´lÃ©, pas d'Ã©lan","Expirer en montant les jambes","Progression: genoux flÃ©chis â†’ jambes tendues â†’ L-sit"]},
  {id:31,name:"Ab Rollout",cat:"Core",type:"Poids du corps",
   met:6,muscles:["Abdominaux","Dorsaux","Ã‰paules","Lombaires"],
   img:"https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=400&q=80",
   desc:"Avec roue ou barre, s'Ã©tendre au maximum devant soi puis revenir. L'un des exercices de gainage les plus difficiles. Engagement extrÃªme du tronc.",
   tips:["Ne jamais creuser le bas du dos â€” protection lombaire","Progression: genoux puis debout","Revenir en contractant les abdominaux, pas le dos"]},

  // â”€â”€â”€ KETTLEBELL (dans Cardio) â”€â”€â”€
  {id:32,name:"KB Swing (Russe)",cat:"Cardio",type:"Kettlebell",
   met:9.8,muscles:["Fessiers","Ischio","Lombaires","Core","Avant-bras"],
   img:"https://images.unsplash.com/photo-1598971457999-ca4ef48a9a71?w=400&q=80",
   desc:"Le mouvement fondamental du kettlebell. Hip hinge explosif â€” bras PASSIFS, propulsion uniquement par les hanches. Puissance, cardio, force en un seul mouvement.",
   tips:["Hanches EN ARRIÃˆRE (hip hinge), pas squat","La cloche monte grÃ¢ce Ã  la puissance des fessiers","Bras relÃ¢chÃ©s â€” la cloche flotte au sommet","Contraction maximale des fessiers en haut"]},
  {id:33,name:"KB Turkish Get-Up",cat:"Cardio",type:"Kettlebell",
   met:6,muscles:["Corps complet","Ã‰paules","Core","Stabilisateurs"],
   img:"https://images.unsplash.com/photo-1547919307-1ecb10702e6f?w=400&q=80",
   desc:"Du sol Ã  debout avec KB maintenu au-dessus de la tÃªte. 7 Ã©tapes distinctes. L'exercice le plus complet qui existe â€” mobilitÃ©, force, stabilitÃ©.",
   tips:["Regard sur la cloche en permanence","Chaque phase lente, contrÃ´lÃ©e, consciente","Commencer sans poids (main vide) pour apprendre","Ne jamais se prÃ©cipiter â€” qualitÃ© absolue"]},
  {id:34,name:"KB Clean & Press",cat:"Cardio",type:"Kettlebell",
   met:8,muscles:["Corps complet","Ã‰paules","Biceps","Core","Fessiers"],
   img:"https://images.unsplash.com/photo-1598971457999-ca4ef48a9a71?w=400&q=80",
   desc:"Nettoyer la cloche vers l'Ã©paule en position rack puis presser au-dessus de la tÃªte. EnchaÃ®ne un mouvement balistique et un mouvement de force.",
   tips:["Position rack: avant-bras contre le tronc, cloche reposant sur le poignet","Descente du press avant de re-cleaner","Gainage strict pendant le press"]},
  {id:35,name:"KB Snatch",cat:"Cardio",type:"Kettlebell",
   met:11,muscles:["Corps complet","ExplosivitÃ©","Cardio"],
   img:"https://images.unsplash.com/photo-1547919307-1ecb10702e6f?w=400&q=80",
   desc:"Du bas en un seul mouvement fluide jusqu'au bras tendu au-dessus de la tÃªte. Le test officiel KB est 100 snatches en 5 minutes. ExplosivitÃ© maximale.",
   tips:["Le 'corkscrew' pour le poignet: rotation en hauteur","Punch vers le plafond avec le poing â€” ne jamais laisser la cloche cogner le poignet","Pratiquer le swing et le clean avant ce mouvement"]},
  {id:36,name:"KB Goblet Squat",cat:"Cardio",type:"Kettlebell",
   met:6,muscles:["Quadriceps","Fessiers","Core","Dorsaux","Adducteurs"],
   img:"https://images.unsplash.com/photo-1598971457999-ca4ef48a9a71?w=400&q=80",
   desc:"Maintenir la KB Ã  deux mains contre la poitrine. Squat profond encouragÃ© par le contre-poids. Renforce le core et la mobilitÃ© de hanche simultanÃ©ment.",
   tips:["Coudes viennent entre les genoux en bas","Talons au sol â€” profondeur maximale","Push knees out avec les coudes si nÃ©cessaire"]},
  {id:37,name:"KB Farmer's Walk",cat:"Cardio",type:"Kettlebell",
   met:5,muscles:["Avant-bras","TrapÃ¨zes","Core","Jambes","Cardio"],
   img:"https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=400&q=80",
   desc:"Marcher avec des charges lourdes. Simple en apparence, brutal en pratique. DÃ©veloppe le grip, la posture et l'endurance musculaire globale.",
   tips:["Ã‰paules en arriÃ¨re et vers le bas","Torse droit, regard devant","Pas courts et rapides pour la stabilitÃ©","Charge = bodyweight total (moitiÃ© par main)"]},
  {id:38,name:"KB Windmill",cat:"Cardio",type:"Kettlebell",
   met:5,muscles:["Core","Obliques","Ã‰paules","Ischio","MobilitÃ©"],
   img:"https://images.unsplash.com/photo-1547919307-1ecb10702e6f?w=400&q=80",
   desc:"KB au-dessus de la tÃªte, rotation latÃ©rale jusqu'Ã  toucher le sol avec la main libre. MobilitÃ© de hanche et stabilitÃ© d'Ã©paule extraordinaires.",
   tips:["Regard sur la cloche en permanence","Jambe sous la cloche lÃ©gÃ¨rement flÃ©chie","La rotation vient du buste, pas de la hanche"]},
  {id:39,name:"KB Renegade Row",cat:"Cardio",type:"Kettlebell",
   met:8,muscles:["Dorsaux","Core","Biceps","Stabilisateurs","Ã‰paules"],
   img:"https://images.unsplash.com/photo-1598971457999-ca4ef48a9a71?w=400&q=80",
   desc:"Planche sur deux KB, row alternatif. La position de planche exige un gainage intense pour rÃ©sister Ã  la rotation. Full body absolu.",
   tips:["Pieds larges (base large) pour la stabilitÃ©","Ne jamais tourner le bassin â€” anti-rotation totale","1 rÃ©pÃ©tition = 1 pompe + row gauche + row droit"]},
  {id:40,name:"KB Press unilatÃ©ral",cat:"Cardio",type:"Kettlebell",
   met:5,muscles:["Ã‰paules","Triceps","Core anti-rotation","TrapÃ¨ze"],
   img:"https://images.unsplash.com/photo-1547919307-1ecb10702e6f?w=400&q=80",
   desc:"Press strict d'une main depuis la position rack. Le core travaille dur pour rÃ©sister Ã  la rotation latÃ©rale. AsymÃ©trie rÃ©vÃ©latrice des dÃ©sÃ©quilibres.",
   tips:["Position rack correcte: avant-bras vertical","Gainage anti-rotation strict","Progression: push press puis press strict"]},
  {id:41,name:"KB Halo",cat:"Cardio",type:"Kettlebell",
   met:4,muscles:["Ã‰paules","Triceps","Core","MobilitÃ© thoracique"],
   img:"https://images.unsplash.com/photo-1598971457999-ca4ef48a9a71?w=400&q=80",
   desc:"Cercles complets autour de la tÃªte avec la KB. Mobilisation des Ã©paules, activation du core. Parfait en Ã©chauffement ou finisher lÃ©ger.",
   tips:["Mouvements lents et contrÃ´lÃ©s â€” qualitÃ© > vitesse","Core engagÃ© â€” ne pas cambrer","Amplitude complÃ¨te des deux cÃ´tÃ©s"]},

  // â”€â”€â”€ CARDIO â”€â”€â”€
  {id:42,name:"Course Ã  pied",cat:"Cardio",type:"Cardio",
   met:9.8,muscles:["Cardio-vasculaire","Mollets","Ischio","Quadriceps"],
   img:"https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=400&q=80",
   desc:"L'activitÃ© cardio de rÃ©fÃ©rence. MET 9.8 pour 10km/h. Adapte l'allure selon tes objectifs: endurance (zone 2), tempo, fractionnÃ©.",
   tips:["Zone 2: pouvoir tenir une conversation","FractionnÃ©: 8Ã—400m rÃ©cupÃ©ration 90s","Chaussures adaptÃ©es, surface variÃ©e"]},
  {id:43,name:"VÃ©lo (intensitÃ© modÃ©rÃ©e)",cat:"Cardio",type:"Cardio",
   met:7,muscles:["Cardio-vasculaire","Quadriceps","Mollets","Fessiers"],
   img:"https://images.unsplash.com/photo-1534787238916-9ba6764efd4f?w=400&q=80",
   desc:"Faible impact articulaire, haute efficacitÃ© cardiovasculaire. Parfait en rÃ©cupÃ©ration active ou en LISS cardio.",
   tips:["Selle Ã  hauteur de hanche pour protÃ©ger les genoux","Cadence Ã©levÃ©e (80-100rpm) + rÃ©sistance = moins de stress articulaire","Test FTP pour calibrer les zones d'entraÃ®nement"]},
  {id:44,name:"Corde Ã  sauter",cat:"Cardio",type:"HIIT",
   met:12,muscles:["Cardio-vasculaire","Mollets","Ã‰paules","Coordination"],
   img:"https://images.unsplash.com/photo-1601422407692-ec4eeec1d9b3?w=400&q=80",
   desc:"Une des activitÃ©s les plus caloriques par minute. 10 minutes = ~130 kcal pour 80kg. Coordination, rÃ©activitÃ©, cardio tout en mÃªme temps.",
   tips:["Atterrir sur la pointe des pieds","Poignets qui tournent, pas les bras","ProgrÃ¨s: double saut, double unders, crossover"]},
  {id:45,name:"Burpees",cat:"Cardio",type:"HIIT",
   met:12,muscles:["Corps complet","Cardio","ExplosivitÃ©"],
   img:"https://images.unsplash.com/photo-1571019613576-2b22c76fd955?w=400&q=80",
   desc:"L'exercice le plus brutal de poids de corps. Squat + pompe + saut. BrÃ»le 10â€“15 kcal/min. Aucun Ã©quipement nÃ©cessaire.",
   tips:["Rythme soutenable sur la durÃ©e","Sauter aussi haut que possible","Modifier: sans pompe ou sans saut pour dÃ©butants"]},
  {id:46,name:"Rowing (ergomÃ¨tre)",cat:"Cardio",type:"Cardio",
   met:9,muscles:["Dos","Jambes","Bras","Cardio â€” full body"],
   img:"https://images.unsplash.com/photo-1591741536024-3b2bc84a6b76?w=400&q=80",
   desc:"L'ergomÃ¨tre Concept2 sollicite 86% des muscles du corps. SÃ©quence: jambes â†’ dos â†’ bras (70/20/10% de l'effort). Cardio de haut niveau.",
   tips:["SÃ©quence jambes-dos-bras (pas l'inverse)","Drive avec les jambes â€” 60% de la puissance","Damper Ã  3-5 pour maintenir la cadence"]},
  {id:47,name:"HIIT Sprint",cat:"Cardio",type:"HIIT",
   met:13,muscles:["Cardio-vasculaire","ExplosivitÃ©","Corps complet"],
   img:"https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=400&q=80",
   desc:"Intervalles de sprint maximal alternÃ©s avec rÃ©cupÃ©ration. 8Ã—30s sprint / 90s repos = 16 minutes pour une efficacitÃ© extrÃªme.",
   tips:["Ã‰chauffement 5min minimum","20s effort maximal / 40s repos (Tabata)","Limiter Ã  2â€“3 sessions par semaine"]},
  {id:48,name:"Natation",cat:"Cardio",type:"Cardio",
   met:7,muscles:["Corps complet","Cardio","Ã‰paules","Dos","Core"],
   img:"https://images.unsplash.com/photo-1530549387789-4c1017266635?w=400&q=80",
   desc:"Cardio zÃ©ro-impact, sollicite tout le corps. Crawl = MET 10, brasse = MET 7. Excellent pour les personnes avec blessures articulaires.",
   tips:["Crawl > brasse pour calorie/heure","Technique de respiration bilatÃ©rale","Intervalles: 4Ã—50m rÃ©cup 30s"]},

  // â”€â”€â”€ CROSSFIT / HYBRIDE â”€â”€â”€
  {id:49,name:"Thruster",cat:"Crossfit",type:"HIIT",
   met:10,muscles:["Quadriceps","Fessiers","Ã‰paules","Triceps","Core"],
   img:"https://images.unsplash.com/photo-1623874228601-f4193c7b1818?w=400&q=80",
   desc:"Squat frontal enchaÃ®nÃ© avec un dÃ©veloppÃ© militaire en un seul mouvement continu. L'un des exercices les plus Ã©puisants du CrossFit. Wod Fran inclut 21-15-9 thrusters.",
   tips:["Utiliser la puissance des jambes pour aider le press","Ne jamais s'arrÃªter en bas â€” momentum continu","Respirer EN HAUT â€” jamais sous tension"]},
  {id:50,name:"Box Jump",cat:"Crossfit",type:"HIIT",
   met:10,muscles:["Quadriceps","Fessiers","Mollets","ExplosivitÃ©"],
   img:"https://images.unsplash.com/photo-1581009137042-c552e485697a?w=400&q=80",
   desc:"Saut explosif sur une box. DÃ©veloppe la puissance explosive et la rÃ©activitÃ©. Hauteur progressant de 20cm Ã  60cm+ selon niveau.",
   tips:["Atterrir flÃ©chi sur la box â€” absorber l'impact","Descendre en marchant pour prÃ©server les tendons","Rebond: enchaÃ®ner depuis le sol sans pause"]},
];

// Cardio activities (for the cardio log section)
const CARDIO_ACTS = [
  {id:'c1',name:"Course Ã  pied",met:9.8,icon:"ğŸƒ",unit:"km",img:"https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=200&q=80"},
  {id:'c2',name:"VÃ©lo",met:7.5,icon:"ğŸš´",unit:"km",img:"https://images.unsplash.com/photo-1534787238916-9ba6764efd4f?w=200&q=80"},
  {id:'c3',name:"Corde Ã  sauter",met:12,icon:"â­•",unit:"min",img:"https://images.unsplash.com/photo-1601422407692-ec4eeec1d9b3?w=200&q=80"},
  {id:'c4',name:"Rameur",met:9,icon:"ğŸš£",unit:"min",img:"https://images.unsplash.com/photo-1591741536024-3b2bc84a6b76?w=200&q=80"},
  {id:'c5',name:"HIIT Sprint",met:13,icon:"âš¡",unit:"min",img:"https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=200&q=80"},
  {id:'c6',name:"Natation",met:7,icon:"ğŸŠ",unit:"min",img:"https://images.unsplash.com/photo-1530549387789-4c1017266635?w=200&q=80"},
  {id:'c7',name:"Marche rapide",met:5,icon:"ğŸš¶",unit:"min",img:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&q=80"},
  {id:'c8',name:"Escalier",met:8,icon:"ğŸªœ",unit:"min",img:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=200&q=80"},
  {id:'c9',name:"KB Swing",met:9.8,icon:"ğŸ””",unit:"min",img:"https://images.unsplash.com/photo-1517344884509-a0c97ec11bcc?w=200&q=80"},
  {id:'c10',name:"KB Snatch",met:11,icon:"ğŸ””",unit:"min",img:"https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?w=200&q=80"},
  {id:'c11',name:"Kettlebell Circuit",met:10,icon:"ğŸ””",unit:"min",img:"https://images.unsplash.com/photo-1517344884509-a0c97ec11bcc?w=200&q=80"},
  {id:'c12',name:"Elliptique",met:6,icon:"ğŸ”„",unit:"min",img:"https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=200&q=80"},
  {id:'c13',name:"Yoga / Stretching",met:3,icon:"ğŸ§˜",unit:"min",img:"https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=200&q=80"},
];

function getAllEx() {
  const custom = (db.custom||[]).map(c=>({...c,isCustom:true}));
  return [...EX_DB, ...custom];
}

// Calorie calculation using MET formula
// kcal = MET Ã— weight_kg Ã— duration_hours
function calcCalFromMet(met, weightKg, durationMin) {
  return Math.round(met * weightKg * (durationMin / 60));
}

// Strength calories: use MET * sets * ~2.5min per set * bw
function calcStrengthCal(exItem, bw) {
  const sets = exItem.sets || [];
  const totalSets = sets.length;
  const avgDurPerSet = 2.5; // minutes per set including micro-rests
  const met = (exItem.ex && exItem.ex.met) || C.MET_DEFAULT;
  const baseCal = calcCalFromMet(met, bw, totalSets * avgDurPerSet / 60 * 60);
  // Add volume component: heavier sets = more energy
  const volCal = sets.reduce((s, st) => s + (st.weight||0) * (st.reps||0) * 0.000175, 0);
  return Math.round(baseCal + volCal);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curPage = 'dash';
let progTab = 'stats';

function goPage(p) {
  document.querySelectorAll('.pg').forEach(e=>e.classList.remove('on'));
  document.querySelectorAll('.nb').forEach(e=>e.classList.remove('on'));
  document.querySelectorAll('.mob-nav-btn').forEach(e=>e.classList.remove('on'));
  document.getElementById('pg-'+p).classList.add('on');
  (function(){var _e=document.getElementById('nb-'+p);if(_e)_e.classList.add('on');})();
  (function(){var _e=document.getElementById('mnb-'+p);if(_e)_e.classList.add('on');})();
  // Scroll to top on page change (mobile)
  window.scrollTo({top:0, behavior:'smooth'});
  curPage = p;
  if(p==='dash') renderDash();
  if(p==='lib') renderLib();
  if(p==='log') initLog();
  if(p==='hist') renderHist();
  if(p==='prog') renderProg();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDash() {
  const ws = db.workouts;
  const now = new Date();
  const tod = today();
  const greetings = ['PRÃŠT Ã€ SOULEVER ?','C\'EST L\'HEURE !','PLUS FORT QU\'HIER','CONSISTENCY IS KEY','LET\'S GO CHAMP'];
  document.getElementById('dash-title').textContent = greetings[Math.floor(Math.random()*greetings.length)];

  const weekStart = new Date(now); weekStart.setDate(weekStart.getDate()-7);
  const weekWs = ws.filter(w=>new Date(w.date)>=weekStart);
  const totalCal = ws.reduce((s,w)=>s+(w.kcal||0),0);
  const weekCal = weekWs.reduce((s,w)=>s+(w.kcal||0),0);
  const streak = getStreak();
  const totalVol = ws.reduce((s,w)=>s+(w.volume||0),0);

  document.getElementById('dash-sub').textContent = `${tod} Â· ${ws.length} sÃ©ances Â· ${streak} jours de sÃ©rie`;

  if(streak>0) document.getElementById('dash-streak-badge').innerHTML = `<span style="background:rgba(255,140,0,.12);color:#ffa830;border:1px solid rgba(255,140,0,.3);padding:4px 12px;border-radius:20px;font-size:.78rem;font-weight:700">ğŸ”¥ ${streak} jours</span>`;

  document.getElementById('dash-stats').innerHTML = [
    {l:'SÃ©ances',v:ws.length,u:'total',col:'#c6ff00',glow:'rgba(198,255,0,.07)'},
    {l:'Calories',v:Math.round(totalCal).toLocaleString(),u:'kcal brÃ»lÃ©es',col:'#ff8c00',glow:'rgba(255,140,0,.07)'},
    {l:'Cette semaine',v:weekCal.toLocaleString(),u:'kcal / 7 jours',col:'#ff3b3b',glow:'rgba(255,59,59,.07)'},
    {l:'Volume total',v:Math.round(totalVol/1000*10)/10,u:'tonnes soulevÃ©es',col:'#3b8bff',glow:'rgba(59,139,255,.07)'},
    {l:'Records',v:countPRs(),u:'PRs Ã©tablis',col:'#00e5cc',glow:'rgba(0,229,204,.07)'},
    {l:'SÃ©rie',v:streak,u:'jours consÃ©cutifs',col:'#c6ff00',glow:'rgba(198,255,0,.07)'},
  ].map(s=>`<div class="sc" style="--sc-col:${s.col};--sc-glow:${s.glow}">
    <div class="sc-lbl">${s.l}</div>
    <div class="sc-val">${s.v}</div>
    <div class="sc-unit">${s.u}</div>
  </div>`).join('');

  const days=[];
  for(let i=6;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);days.push(d.toISOString().split('T')[0]);}
  const calD = days.map(d=>ws.filter(w=>w.date===d).reduce((s,w)=>s+(w.kcal||0),0));
  const volD = days.map(d=>ws.filter(w=>w.date===d).reduce((s,w)=>s+(w.volume||0),0));
  renderBars('d-cal-bars','d-cal-xl',calD,days.map(d=>d.slice(5)),'kcal','linear-gradient(180deg,#c6ff00,rgba(198,255,0,.25))');
  renderBars('d-vol-bars','d-vol-xl',volD,days.map(d=>d.slice(5)),'kg','linear-gradient(180deg,#3b8bff,rgba(59,139,255,.25))');

  // Daily quote
  const q = QUOTES[Math.floor((new Date().getTime()/86400000))%QUOTES.length];
  const dq = document.getElementById('dash-quote');
  const da = document.getElementById('dash-quote-author');
  if(dq) dq.textContent = q.text;
  if(da) da.textContent = 'â€” '+q.author;

  // Water tracker
  const water = (db.water && db.water[today()])||0;
  document.getElementById('water-count').textContent = water;
  const wt = document.getElementById('water-track');
  if(wt) wt.innerHTML = Array.from({length:8},(_,i)=>
    `<button class="water-btn ${i<water?'filled':''}" onclick="addWater(${i+1})" title="${i+1} verre${i>0?'s':''}">ğŸ’§</button>`
  ).join('');

  const rec = ws.slice(-5).reverse();
  document.getElementById('dash-recent').innerHTML = rec.length ? rec.map(w=>`
    <div class="wo-item" onclick="openWoDetail(${w.id})">
      <div class="wo-type-badge" style="background:${typeColor(w.type)}">${typeIcon(w.type)}</div>
      <div class="wo-info">
        <div class="wo-name">${w.name||'SÃ©ance'}</div>
        <div class="wo-meta">${fDate(w.date)} Â· ${w.duration||'?'}min Â· ${(w.exercises||[]).length}+(${(w.cardio||[]).length}) exos</div>
      </div>
      <div class="wo-stats">
        <div class="wo-kcal">${w.kcal||0} kcal</div>
        <div class="wo-dur">${w.volume||0} kg vol.</div>
      </div>
      <button class="btn-icon" onclick="event.stopPropagation();askDelete('wo',${w.id})" title="Supprimer">ğŸ—‘</button>
    </div>`).join('') 
  : '<div class="empty"><div class="empty-icon">ğŸ‹ï¸</div><p>Aucune sÃ©ance encore.<br>Lance ta premiÃ¨re sÃ©ance !</p></div>';
}

function detectNewPRs(wo){
  const prs=[];
  (wo.exercises||[]).forEach(exItem=>{
    const prevBest = db.workouts
      .filter(w=>w.id!==wo.id)
      .flatMap(w=>(w.exercises||[]))
      .filter(e=>e.id===exItem.id)
      .flatMap(e=>(e.sets||[]))
      .reduce((max,s)=>Math.max(max,s.weight||0),0);
    const newBest = (exItem.sets||[]).reduce((max,s)=>Math.max(max,s.weight||0),0);
    if(newBest>prevBest && newBest>0){
      const exName = (getAllEx().find(e=>e.id===exItem.id)||{}).name||'Exercice';
      prs.push(exName+' '+newBest+'kg');
    }
  });
  return prs;
}

function addWater(n) {
  if(!db.water) db.water={};
  db.water[today()] = db.water[today()]===n ? n-1 : n;
  save();
  renderDash();
}
function resetWater() {
  if(!db.water) db.water={};
  db.water[today()]=0;
  save();
  renderDash();
}

function typeIcon(t) {
  return {strength:'ğŸ‹ï¸',cardio:'ğŸƒ',mixed:'âš¡'}[t]||'ğŸ’ª';
}
function typeColor(t) {
  return {strength:'rgba(198,255,0,.1)',cardio:'rgba(0,229,204,.1)',mixed:'rgba(255,140,0,.1)'}[t]||'rgba(255,255,255,.05)';
}

function renderBars(bId, xlId, data, labels, unit, grad) {
  const max = Math.max(...data,1);
  document.getElementById(bId).innerHTML = data.map((v,i)=>`
    <div class="bar-c">
      <div class="bar-f" style="height:${Math.max(3,(v/max)*94)}px;background:${grad}" data-tip="${v} ${unit}"></div>
    </div>`).join('');
  document.getElementById(xlId).innerHTML = labels.map(l=>`<div class="bar-xl" style="flex:1">${l}</div>`).join('');
}

function getStreak() {
  if(!db.workouts.length) return 0;
  const dates = [...new Set(db.workouts.map(w=>w.date))].sort().reverse();
  let s=0; const t=new Date(); t.setHours(0,0,0,0);
  for(let i=0;i<dates.length;i++){
    const d=new Date(dates[i]); d.setHours(0,0,0,0);
    const diff=Math.round((t-d)/86400000);
    if(diff===i||diff===i+1) s++; else break;
  }
  return s;
}
function countPRs() {
  const r={};
  db.workouts.forEach(w=>(w.exercises||[]).forEach(ex=>(ex.sets||[]).forEach(s=>{
    if(s.weight>0&&(!r[ex.id]||s.weight>r[ex.id])) r[ex.id]=s.weight;
  })));
  return Object.keys(r).length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   LIBRARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let libFlt = 'Tous';

function renderLib() {
  const all = getAllEx();
  const q = ((document.getElementById('lib-q')||{}).value||'').toLowerCase();
  const cats = ['Tous',...new Set(all.map(e=>e.cat))];
  document.getElementById('lib-flt').innerHTML = cats.map(c=>`<button class="fb ${c===libFlt?'on':''}" onclick="libFlt='${c}';renderLib()">${c}</button>`).join('');
  let filtered = all.filter(e=>{
    const mc = libFlt==='Tous'||e.cat===libFlt;
    const mq = !q||e.name.toLowerCase().includes(q)||(e.muscles||[]).some(m=>m.toLowerCase().includes(q))||e.cat.toLowerCase().includes(q);
    return mc&&mq;
  });
  document.getElementById('lib-count').textContent = `${filtered.length} exercice${filtered.length>1?'s':''}`;
  document.getElementById('lib-grid').innerHTML = filtered.map(ex=>`
    <div class="exc ${ex.isCustom?'exc-custom':''}" onclick="openDetail(${ex.id},${!!ex.isCustom})">
      <div class="exc-img">
        <img src="${ex.img||''}" alt="${ex.name}" loading="lazy" onerror="this.style.display='none';this.parentNode.style.background='#1a1a28';this.parentNode.innerHTML+='<div style=\\'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:3rem;\\'>${ex.icon||'ğŸ‹ï¸'}</div>'">
        <div class="exc-badge">${ex.met} MET</div>
        ${ex.isCustom?'<div style="position:absolute;top:8px;left:8px;background:rgba(0,229,204,.15);border:1px solid rgba(0,229,204,.3);border-radius:4px;padding:1px 6px;font-size:.62rem;color:#00e5cc;font-weight:700">CUSTOM</div>':''}
      </div>
      <div class="exc-body">
        <div class="exc-name">${ex.name}</div>
        <div class="exc-tags">
          <span class="tag tm">${ex.type}</span>
          <span class="tag tg">${(ex.muscles||[])[0]||ex.cat}</span>
        </div>
      </div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   EXERCISE DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let detEx = null;
let detTarget = 'strength'; // which section to add to

function openDetail(id, isCustom) {
  const all = getAllEx();
  const ex = all.find(e=>e.id==id&&!!e.isCustom===!!isCustom);
  if(!ex) return;
  detEx = ex;
  document.getElementById('det-name').textContent = ex.name;
  document.getElementById('det-tags').innerHTML = [
    `<span class="tag tm">${ex.type}</span>`,
    `<span class="tag tg">${ex.cat}</span>`,
    `<span class="tag tc">MET ${ex.met}</span>`,
    ex.isCustom?'<span class="tag tk">Custom</span>':''
  ].join('');

  const imgEl = document.getElementById('det-img');
  imgEl.innerHTML = `
    <img src="${ex.img||''}" alt="${ex.name}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display='none'">
    <div class="det-img-overlay"></div>
    <div class="det-img-info">
      <div style="font-size:.72rem;color:rgba(255,255,255,.6);margin-bottom:4px">MUSCLES PRIMAIRES</div>
      <div style="font-size:.88rem;font-weight:600">${(ex.muscles||[]).join(' Â· ')}</div>
    </div>`;

  document.getElementById('det-desc').textContent = ex.desc||'';
  document.getElementById('det-stats').innerHTML = [
    {l:'MET (intensitÃ©)',v:ex.met,col:'#c6ff00'},
    {l:'Type',v:ex.type,col:'#f0f0f8'},
    {l:'Groupe',v:ex.cat,col:'#f0f0f8'},
  ].map(s=>`<div class="det-stat"><div class="det-stat-lbl">${s.l}</div><div class="det-stat-val" style="color:${s.col}">${s.v}</div></div>`).join('');

  document.getElementById('det-mus').innerHTML = (ex.muscles||[]).map(m=>`<span class="tag tg">${m}</span>`).join('');
  document.getElementById('det-tips').innerHTML = (ex.tips||[]).map(t=>`<div class="tip-item">${t}</div>`).join('');

  if(ex.isCustom) {
    document.getElementById('det-custom-actions').innerHTML = `
      <button class="btn btn-teal btn-sm" onclick="openCustomModal(${ex.id})">âœï¸ Modifier</button>
      <button class="btn btn-red btn-sm" onclick="askDelete('ex',${ex.id})">ğŸ—‘ Supprimer</button>`;
  } else document.getElementById('det-custom-actions').innerHTML='';

  openOv('ov-detail');
}

function addExFromDetail() {
  if(!detEx) return;
  addExToLog(detEx, detTarget);
  closeOv('ov-detail');
  goPage('log');
  showToast('â• '+detEx.name+' ajoutÃ©');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   SESSION LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sessionType = 'strength';
let logStrengthExs = [];  // [{ex, sets:[{weight,reps,done}]}]
let logCardioExs = [];   // [{act, duration, distance, notes}]
let addExTargetType = 'strength';
let addExFlt = 'Tous';

function setSessionType(t) {
  sessionType = t;
  ['strength','cardio','mixed'].forEach(s=>{
    document.getElementById('stp-'+s).classList.toggle('on',s===t);
    document.getElementById('stp-'+s).classList.remove('lime','orange','teal');
  });
  const cols = {strength:'lime',cardio:'teal',mixed:'orange'};
  document.getElementById('stp-'+t).classList.add(cols[t]);
  document.getElementById('cardio-section').style.display = (t==='cardio'||t==='mixed')?'block':'none';
  document.getElementById('strength-section').style.display = (t==='strength'||t==='mixed')?'block':'none';
  updateSummary();
}

function initLog() {
  if(!document.getElementById('log-date').value)
    document.getElementById('log-date').value = today();
  // Pre-fill bodyweight from latest poids
  const bwIn = document.getElementById('log-bw');
  if(!bwIn.value && (db.poids && db.poids.length))
    bwIn.value = db.poids[db.poids.length-1].weight;
  renderStrengthList();
  renderCardioList();
  updateSummary();
}

function openAddExModal(target) {
  addExTargetType = target;
  addExFlt = 'Tous';
  document.getElementById('add-q').value = '';
  document.getElementById('ov-add-sub').textContent = target==='cardio' ? 'ActivitÃ© cardio' : 'Exercice de musculation / KB';
  renderAddList();
  openOv('ov-add');
}

let addFltFilterActive = 'Tous';
function renderAddList() {
  const q = ((document.getElementById('add-q')||{}).value||'').toLowerCase();
  let pool;
  if(addExTargetType==='cardio') {
    pool = CARDIO_ACTS.filter(a=>!q||a.name.toLowerCase().includes(q));
    document.getElementById('add-flt').innerHTML='';
    document.getElementById('add-list').innerHTML = pool.map(a=>`
      <div class="wo-item hov" onclick="addCardioToLog('${a.id}');closeOv('ov-add')">
        <div class="wo-type-badge" style="background:rgba(0,229,204,.1);font-size:1.2rem">${a.icon}</div>
        <div class="wo-info">
          <div class="wo-name">${a.name}</div>
          <div class="wo-meta">MET ${a.met} Â· unitÃ©: ${a.unit}</div>
        </div>
      </div>`).join('');
    return;
  }
  const all = getAllEx().filter(e=>e.type!=='Cardio'&&e.cat!=='Cardio');
  const cats = ['Tous',...new Set(all.map(e=>e.cat))];
  document.getElementById('add-flt').innerHTML = cats.map(c=>`<button class="fb ${c===addExFlt?'on':''}" onclick="addExFlt='${c}';renderAddList()">${c}</button>`).join('');
  pool = all.filter(e=>{
    const mc=addExFlt==='Tous'||e.cat===addExFlt;
    const mq=!q||e.name.toLowerCase().includes(q)||(e.muscles||[]).some(m=>m.toLowerCase().includes(q));
    return mc&&mq;
  });
  document.getElementById('add-list').innerHTML = pool.map(ex=>`
    <div class="wo-item hov" onclick="addExToLog(getAllEx().find(e=>e.id===${ex.id}&&!!e.isCustom===${!!ex.isCustom}),'strength');closeOv('ov-add')">
      <div style="width:42px;height:42px;border-radius:8px;overflow:hidden;flex-shrink:0">
        <img src="${ex.img||''}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display='none'">
      </div>
      <div class="wo-info">
        <div class="wo-name">${ex.name}</div>
        <div class="wo-meta">${(ex.muscles||[])[0]||''} Â· MET ${ex.met} Â· ${ex.type}</div>
      </div>
    </div>`).join('');
}

function addExToLog(ex, target) {
  if(!ex) return;
  if(target==='strength') {
    logStrengthExs.push({ex, sets:[{weight:0,reps:10,done:false}]});
    renderStrengthList();
  }
  updateSummary();
}

function addCardioToLog(actId) {
  const act = CARDIO_ACTS.find(a=>a.id===actId);
  if(!act) return;
  logCardioExs.push({act, duration:30, distance:0, notes:''});
  renderCardioList();
  updateSummary();
}

function renderStrengthList() {
  const el = document.getElementById('strength-ex-list');
  if(!logStrengthExs.length){
    el.innerHTML='<div class="empty" style="padding:24px"><div class="empty-icon" style="font-size:1.8rem;opacity:.2">ğŸ‹ï¸</div><p style="font-size:.82rem">Ajoute des exercices de musculation</p></div>';
    return;
  }
  el.innerHTML = logStrengthExs.map((item,i)=>`
    <div class="ex-log-item">
      <div class="eli-head" onclick="toggleExBody(${i})">
        <div class="eli-thumb">
          <img src="${item.ex.img||''}" alt="" onerror="this.parentNode.style.background='#13131f';this.style.display='none'">
        </div>
        <div class="eli-info">
          <div class="eli-name">${item.ex.name}</div>
          <div class="eli-meta">${item.sets.length} sÃ©rie(s) Â· ${item.sets.filter(s=>s.done).length} complÃ©tÃ©e(s) Â· MET ${item.ex.met}</div>
        </div>
        <button class="btn btn-teal btn-sm" onclick="event.stopPropagation();startRest()" title="Chrono repos">â±</button>
        <button class="btn-icon" onclick="event.stopPropagation();removeStrEx(${i})">âœ•</button>
      </div>
      <div class="eli-body" id="ex-body-${i}">
        <div style="margin:12px 0 8px">
          ${item.sets.map((s,j)=>`
            <div class="set-row">
              <span class="set-n">S${j+1}</span>
              <input class="set-in" type="number" value="${s.weight||''}" placeholder="kg" min="0" step="0.5" oninput="updateSSet(${i},${j},'weight',this.value)">
              <span class="set-u">kg</span>
              <input class="set-in" type="number" value="${s.reps||''}" placeholder="reps" min="1" oninput="updateSSet(${i},${j},'reps',this.value)">
              <span class="set-u">reps</span>
              <button class="set-done ${s.done?'done':''}" onclick="toggleSetDone(${i},${j})" title="${s.done?'Annuler':'SÃ©rie terminÃ©e'}">âœ“</button>
              <button class="set-del" onclick="removeSet(${i},${j})">âœ•</button>
            </div>`).join('')}
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn btn-ghost btn-sm" onclick="addSet(${i})">+ SÃ©rie</button>
          <button class="btn btn-ghost btn-sm" onclick="dupLastSet(${i})">â§‰ Dupliquer</button>
          <button class="btn btn-teal btn-sm" onclick="startRest()">â± Repos</button>
        </div>
      </div>
    </div>`).join('');
  updateSummary();
}

function toggleExBody(i) {
  const el = document.getElementById('ex-body-'+i);
  if(el) el.style.display = el.style.display==='none'?'block':'none';
}

function renderCardioList() {
  const el = document.getElementById('cardio-ex-list');
  if(!logCardioExs.length){
    el.innerHTML='<div class="empty" style="padding:20px"><div class="empty-icon" style="font-size:1.8rem;opacity:.2">ğŸƒ</div><p style="font-size:.82rem">Ajoute une activitÃ© cardio</p></div>';
    return;
  }
  el.innerHTML = logCardioExs.map((item,i)=>`
    <div class="ex-log-item">
      <div class="eli-head">
        <div class="eli-thumb" style="background:rgba(0,229,204,.1);display:flex;align-items:center;justify-content:center;font-size:1.3rem">${item.act.icon}</div>
        <div class="eli-info">
          <div class="eli-name">${item.act.name}</div>
          <div class="eli-meta">MET ${item.act.met} Â· ~${estimateCardioCal(item)} kcal</div>
        </div>
        <button class="btn-icon" onclick="removeCardioEx(${i})">âœ•</button>
      </div>
      <div class="eli-body" style="padding-top:10px">
        <div class="cardio-row">
          <span class="cr-label">DurÃ©e</span>
          <input class="cr-in" type="number" value="${item.duration}" placeholder="minutes" min="1" oninput="updateCardio(${i},'duration',this.value)">
          <span style="font-size:.72rem;color:rgba(238,238,248,0.28);margin-left:4px">min</span>
        </div>
        ${item.act.unit==='km'?`<div class="cardio-row">
          <span class="cr-label">Distance</span>
          <input class="cr-in" type="number" value="${item.distance||''}" placeholder="km" min="0" step="0.1" oninput="updateCardio(${i},'distance',this.value)">
          <span style="font-size:.72rem;color:rgba(238,238,248,0.28);margin-left:4px">km</span>
        </div>`:''}
        <div class="cardio-row">
          <span class="cr-label">Note</span>
          <input class="cr-in" type="text" value="${item.notes||''}" placeholder="Zone 2, fractionnÃ©â€¦" oninput="updateCardio(${i},'notes',this.value)">
        </div>
      </div>
    </div>`).join('');
  updateSummary();
}

function estimateCardioCal(item) {
  const bw = parseFloat((document.getElementById('log-bw')||{}).value)||80;
  return calcCalFromMet(item.act.met, bw, item.duration||30);
}

function updateSSet(i,j,f,v){logStrengthExs[i].sets[j][f]=parseFloat(v)||0;updateSummary();}
function addSet(i){logStrengthExs[i].sets.push({weight:(logStrengthExs[i].sets.slice(-1)[0]||{}).weight||0,reps:10,done:false});renderStrengthList();}
function dupLastSet(i){const s=logStrengthExs[i].sets;s.push({...s[s.length-1],done:false});renderStrengthList();}
function removeSet(i,j){logStrengthExs[i].sets.splice(j,1);if(!logStrengthExs[i].sets.length)logStrengthExs[i].sets.push({weight:0,reps:10,done:false});renderStrengthList();}
function removeStrEx(i){logStrengthExs.splice(i,1);renderStrengthList();}
function toggleSetDone(i,j){logStrengthExs[i].sets[j].done=!logStrengthExs[i].sets[j].done;renderStrengthList();}
function updateCardio(i,f,v){logCardioExs[i][f]=f==='duration'||f==='distance'?parseFloat(v)||0:v;renderCardioList();}
function removeCardioEx(i){logCardioExs.splice(i,1);renderCardioList();}

function updateSummary() {
  const bw = parseFloat((document.getElementById('log-bw')||{}).value)||80;
  let cal=0,vol=0,sets=0;
  logStrengthExs.forEach(item=>{
    cal += calcStrengthCal(item, bw);
    vol += item.sets.reduce((s,st)=>s+(st.weight||0)*(st.reps||0),0);
    sets += item.sets.length;
  });
  logCardioExs.forEach(item=>{ cal += estimateCardioCal(item); });
  const dur = parseInt((document.getElementById('log-dur')||{}).value)||0;
  const intensity = parseFloat((document.getElementById('log-intensity')||{}).value)||1.2;
  cal = Math.round(cal * intensity);
  document.getElementById('sum-cal').textContent = cal;
  document.getElementById('sum-vol').textContent = vol.toLocaleString();
  document.getElementById('sum-sets').textContent = sets;
  document.getElementById('sum-exs').textContent = logStrengthExs.length + logCardioExs.length;
}

function clearLog() {
  logStrengthExs=[];logCardioExs=[];
  renderStrengthList();renderCardioList();updateSummary();
  showToast('ğŸ—‘ SÃ©ance effacÃ©e');
}

function saveWorkout() {
  if(!logStrengthExs.length && !logCardioExs.length){showToast('âš ï¸ Ajoute au moins un exercice','err');return;}
  const bw = parseFloat((document.getElementById('log-bw')||{}).value)||80;
  let cal=0,vol=0;
  logStrengthExs.forEach(item=>{
    cal+=calcStrengthCal(item,bw);
    vol+=item.sets.reduce((s,st)=>s+(st.weight||0)*(st.reps||0),0);
  });
  logCardioExs.forEach(item=>{ cal+=estimateCardioCal(item); });
  const intensity=parseFloat((document.getElementById('log-intensity')||{}).value)||1.2;
  cal=Math.round(cal*intensity);

  db.workouts.push({
    id:Date.now(),
    date:document.getElementById('log-date').value||today(),
    name:document.getElementById('log-name').value.trim()||'SÃ©ance',
    type:sessionType,
    duration:parseInt(document.getElementById('log-dur').value)||0,
    note:document.getElementById('log-note').value,
    bodyweight:bw,
    kcal:cal, volume:Math.round(vol),
    exercises:logStrengthExs.map(item=>({
      id:item.ex.id,isCustom:!!item.ex.isCustom,
      name:item.ex.name,muscles:item.ex.muscles||[],cat:item.ex.cat,met:item.ex.met,
      sets:item.sets
    })),
    cardio:logCardioExs.map(item=>({
      id:item.act.id,name:item.act.name,
      duration:item.duration,distance:item.distance,notes:item.notes,
      met:item.act.met
    }))
  });
  save();
  logStrengthExs=[];logCardioExs=[];
  ['log-name','log-dur','log-note'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('log-date').value=today();
  renderStrengthList();renderCardioList();updateSummary();
  showToast('ğŸ’ª SÃ©ance enregistrÃ©e !','ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   REST TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let restInterval=null;
let restRemaining=0;
let restTotal=90;

function startRest(secs=90){
  clearInterval(restInterval);
  restTotal=secs; restRemaining=secs;
  document.getElementById('rest-timer').classList.add('show');
  updateRestDisplay();
  restInterval=setInterval(()=>{
    restRemaining--;
    updateRestDisplay();
    if(restRemaining<=0){clearInterval(restInterval);skipRest();}
  },1000);
}
function updateRestDisplay(){
  const m=Math.floor(restRemaining/60),s=restRemaining%60;
  document.getElementById('rt-display').textContent=`${m}:${s.toString().padStart(2,'0')}`;
  document.getElementById('rt-fill').style.width=(restRemaining/restTotal*100)+'%';
  document.getElementById('rt-fill').style.background=restRemaining<15?C.RED:C.LIME;
}
function addRestTime(s){restRemaining+=s;restTotal+=s;updateRestDisplay();}
function skipRest(){clearInterval(restInterval);closeRest();}
function closeRest(){document.getElementById('rest-timer').classList.remove('show');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHist() {
  const q=((document.getElementById('hist-q')||{}).value||'').toLowerCase();
  let ws=[...db.workouts].reverse();
  if(q) ws=ws.filter(w=>(w.name||'').toLowerCase().includes(q)||w.date.includes(q)||(w.type||'').includes(q));
  document.getElementById('hist-count').textContent=`${ws.length} sÃ©ance${ws.length>1?'s':''}`;

  const groups={};
  ws.forEach(w=>{const k=w.date.slice(0,7);if(!groups[k])groups[k]=[];groups[k].push(w);});

  document.getElementById('hist-list').innerHTML = Object.keys(groups).length ? Object.entries(groups).map(([m,wos])=>`
    <div class="sec">${fMonth(m)} â€” ${wos.length} sÃ©ance${wos.length>1?'s':''}</div>
    ${wos.map(w=>`
      <div class="wo-item hov" onclick="openWoDetail(${w.id})">
        <div class="wo-type-badge" style="background:${typeColor(w.type)}">${typeIcon(w.type)}</div>
        <div class="wo-info">
          <div class="wo-name">${w.name||'SÃ©ance'}</div>
          <div class="wo-meta">${fDate(w.date)} Â· ${w.duration||'?'}min Â· ${(w.exercises||[]).length} force + ${(w.cardio||[]).length} cardio</div>
        </div>
        <div class="wo-stats">
          <div class="wo-kcal">${w.kcal||0} kcal</div>
          <div class="wo-dur">${w.volume||0} kg vol.</div>
        </div>
        <button class="btn-icon" onclick="event.stopPropagation();askDelete('wo',${w.id})">ğŸ—‘</button>
      </div>`).join('')}`).join('')
  : '<div class="empty"><div class="empty-icon">ğŸ“‹</div><p>Aucune sÃ©ance trouvÃ©e</p></div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   WORKOUT DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentWoId=null;

function openWoDetail(id){
  const w=db.workouts.find(x=>x.id===id);
  if(!w)return;
  currentWoId=id;
  document.getElementById('wo-det-name').textContent=w.name||'SÃ©ance';
  document.getElementById('wo-det-meta').textContent=`${fDate(w.date)} Â· ${w.duration||'?'}min Â· ${w.type||'musculation'}`;
  document.getElementById('wo-det-stats').innerHTML=[
    {l:'Calories',v:w.kcal||0,u:'kcal',c:'#c6ff00'},
    {l:'Volume',v:(w.volume||0).toLocaleString(),u:'kg',c:'#f0f0f8'},
    {l:'Exercices',v:(w.exercises||[]).length+' + '+(w.cardio||[]).length,u:'force + cardio',c:'#b4a0fc'},
  ].map(s=>`<div class="det-stat"><div class="det-stat-lbl">${s.l}</div><div class="det-stat-val" style="color:${s.c}">${s.v}</div><div style="font-size:.65rem;color:rgba(238,238,248,0.28)">${s.u}</div></div>`).join('');

  let body='';
  if((w.exercises||[]).length){
    body+=`<div class="sec" style="margin-top:0">ğŸ‹ï¸ Force</div>`;
    body+=w.exercises.map(ex=>`
      <div style="background:#1a1a28;border-radius:8px;padding:10px 13px;margin-bottom:6px;border:1px solid rgba(255,255,255,0.07)">
        <div style="font-weight:600;font-size:.88rem;margin-bottom:6px">${ex.name}</div>
        <div style="display:flex;gap:5px;flex-wrap:wrap">
          ${(ex.sets||[]).map((s,j)=>`<span style="background:rgba(124,92,252,.15);border:1px solid rgba(124,92,252,.25);border-radius:5px;padding:2px 7px;font-size:.7rem;color:#c4b5fd">S${j+1}${s.weight>0?' '+s.weight+'kgÃ—':''}${s.reps}r</span>`).join('')}
        </div>
      </div>`).join('');
  }
  if((w.cardio||[]).length){
    body+=`<div class="sec">ğŸƒ Cardio</div>`;
    body+=w.cardio.map(c=>`
      <div style="background:rgba(0,229,204,.05);border-radius:8px;padding:10px 13px;margin-bottom:6px;border:1px solid rgba(0,229,204,.15)">
        <div style="font-weight:600;font-size:.88rem">${c.name}</div>
        <div style="font-size:.75rem;color:rgba(238,238,248,0.55);margin-top:3px">${c.duration}min${c.distance?' Â· '+c.distance+'km':''}${c.notes?' Â· '+c.notes:''}</div>
      </div>`).join('');
  }
  if(w.note) body+=`<div style="background:#1a1a28;border-radius:8px;padding:10px 13px;border:1px solid rgba(255,255,255,0.07);font-size:.83rem;color:rgba(238,238,248,0.55);font-style:italic;margin-top:8px">"${w.note}"</div>`;
  document.getElementById('wo-det-body').innerHTML=body;
  openOv('ov-wo');
}

function duplicateWo(){
  const w=db.workouts.find(x=>x.id===currentWoId);
  if(!w)return;
  const n={...JSON.parse(JSON.stringify(w)),id:Date.now(),date:today(),name:w.name+' (copie)'};
  db.workouts.push(n);save();closeOv('ov-wo');renderHist();showToast('ğŸ“‹ SÃ©ance dupliquÃ©e');
}

function reloadWoToLog(){
  const w=db.workouts.find(x=>x.id===currentWoId);
  if(!w)return;
  const all=getAllEx();
  logStrengthExs=(w.exercises||[]).map(ex=>{
    const found=all.find(e=>e.id===ex.id);
    return {ex:found||{id:ex.id,name:ex.name,met:ex.met||5,muscles:ex.muscles,cat:ex.cat,img:''},
            sets:ex.sets.map(s=>({...s,done:false}))};
  });
  logCardioExs=(w.cardio||[]).map(c=>{
    const found=CARDIO_ACTS.find(a=>a.id===c.id);
    return {act:found||{id:c.id,name:c.name,met:c.met||7,icon:'ğŸƒ',unit:'min'},
            duration:c.duration,distance:c.distance||0,notes:c.notes||''};
  });
  setSessionType(w.type||'strength');
  closeOv('ov-wo');goPage('log');
  showToast('ğŸ”„ SÃ©ance chargÃ©e â€” modifie et sauvegarde');
}

function triggerDeleteWo(){askDelete('wo',currentWoId);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   PROGRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProg(){switchTab(progTab);}

function switchTab(t){
  progTab=t;
  ['stats','weight','body','muscles','prs'].forEach(x=>{
    (function(){var _tb=document.getElementById('tb-'+x);if(_tb)_tb.classList.toggle('on',x===t);})();
  });
  const el=document.getElementById('prog-content');
  if(t==='stats') el.innerHTML=buildStats();
  if(t==='weight'){el.innerHTML=buildWeight();setTimeout(drawWeightChart,40);}
  if(t==='body'){el.innerHTML=buildBody();setTimeout(loadBodyMeasures,40);}
  if(t==='muscles') el.innerHTML=buildMuscles();
  if(t==='prs') el.innerHTML=buildPRs();
}

function buildStats(){
  const ws=db.workouts;
  const weeks=getLast10Weeks();
  const calW=weeks.map(w=>ws.filter(x=>new Date(x.date)>=w.s&&new Date(x.date)<=w.e).reduce((s,x)=>s+(x.kcal||0),0));
  const volW=weeks.map(w=>ws.filter(x=>new Date(x.date)>=w.s&&new Date(x.date)<=w.e).reduce((s,x)=>s+(x.volume||0),0));
  const sesW=weeks.map(w=>ws.filter(x=>new Date(x.date)>=w.s&&new Date(x.date)<=w.e).length);
  const wlbl=weeks.map(w=>`${w.s.getDate()}/${w.s.getMonth()+1}`);
  setTimeout(()=>{
    renderBars('pc-cal','pc-cal-xl',calW,wlbl,'kcal','linear-gradient(180deg,#c6ff00,rgba(198,255,0,.2))');
    renderBars('pc-vol','pc-vol-xl',volW,wlbl,'kg','linear-gradient(180deg,#3b8bff,rgba(59,139,255,.2))');
    renderBars('pc-ses','pc-ses-xl',sesW,wlbl,'sÃ©ances','linear-gradient(180deg,#ff8c00,rgba(255,140,0,.2))');
  },30);
  const tot=ws.reduce((a,b)=>({kcal:(a.kcal||0)+(b.kcal||0),volume:(a.volume||0)+(b.volume||0),duration:(a.duration||0)+(b.duration||0)}),{});
  return `
  <div class="g3" style="margin-bottom:12px">
    <div class="sc" style="--sc-col:#c6ff00"><div class="sc-lbl">Calories totales</div><div class="sc-val">${(tot.kcal||0).toLocaleString()}</div><div class="sc-unit">kcal brÃ»lÃ©es</div></div>
    <div class="sc" style="--sc-col:#3b8bff"><div class="sc-lbl">Volume total</div><div class="sc-val">${Math.round((tot.volume||0)/1000)}k</div><div class="sc-unit">kg soulevÃ©s</div></div>
    <div class="sc" style="--sc-col:#ff8c00"><div class="sc-lbl">Temps total</div><div class="sc-val">${Math.round((tot.duration||0)/60)}</div><div class="sc-unit">heures d'entraÃ®nement</div></div>
  </div>
  <div class="g2" style="margin-bottom:12px">
    <div class="chart-box"><div class="chart-hd">ğŸ”¥ Calories / sem.</div><div class="bars" id="pc-cal"></div><div style="display:flex;gap:4px;margin-top:4px" id="pc-cal-xl"></div></div>
    <div class="chart-box"><div class="chart-hd">ğŸ’ª Volume / sem.</div><div class="bars" id="pc-vol"></div><div style="display:flex;gap:4px;margin-top:4px" id="pc-vol-xl"></div></div>
  </div>
  <div class="chart-box"><div class="chart-hd">ğŸ“… FrÃ©quence / sem.</div><div class="bars" id="pc-ses"></div><div style="display:flex;gap:4px;margin-top:4px" id="pc-ses-xl"></div></div>`;
}

function buildWeight(){
  return `<div class="chart-box">
    <div class="chart-hd">âš–ï¸ Ã‰volution du poids</div>
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px;flex-wrap:wrap">
      <div class="fg" style="flex:0 0 110px"><label>Poids (kg)</label><input type="number" id="pw-val" placeholder="80.5" step="0.1" min="30" max="250"></div>
      <div class="fg" style="flex:0 0 150px"><label>Date</label><input type="date" id="pw-date"></div>
      <button class="btn btn-lime btn-sm" style="margin-top:16px" onclick="addWeight()">â• Ajouter</button>
    </div>
    <div class="line-box" id="wt-chart"></div>
    <div id="wt-list" style="max-height:200px;overflow-y:auto;margin-top:12px"></div>
  </div>`;
}

function drawWeightChart(){
  const data=(db.poids||[]).slice(-30);
  const el=document.getElementById('wt-chart');
  const list=document.getElementById('wt-list');
  const dateIn=document.getElementById('pw-date');
  if(dateIn&&!dateIn.value) dateIn.value=today();

  if(list) list.innerHTML=[...data].reverse().map(p=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid rgba(255,255,255,0.07)">
      <span style="color:rgba(238,238,248,0.55);font-size:.83rem">${fDate(p.date)}</span>
      <div style="display:flex;align-items:center;gap:8px">
        <span style="font-family:'Bebas Neue',sans-serif;font-size:1.1rem;color:#c6ff00;letter-spacing:1px">${p.weight}kg</span>
        <button style="background:none;border:none;color:rgba(238,238,248,0.28);cursor:pointer;font-size:.75rem" onclick="delWeight('${p.date}')">ğŸ—‘</button>
      </div>
    </div>`).join('')||'<p style="font-size:.82rem;color:rgba(238,238,248,0.28);padding:8px 0">Aucune mesure</p>';

  if(!el) return;
  if(data.length<2){el.innerHTML='<svg width="100%" height="120"><text x="50%" y="60" fill="rgba(255,255,255,0.2)" text-anchor="middle" font-size="13" font-family="Outfit">Ajoute au moins 2 mesures</text></svg>';return;}
  const W=el.offsetWidth||500,H=120;
  const minW=Math.min(...data.map(d=>d.weight))-1,maxW=Math.max(...data.map(d=>d.weight))+1;
  const R=maxW-minW||1;
  const pts=data.map((d,i)=>[Math.round((i/(data.length-1))*W),Math.round(H-15-((d.weight-minW)/R)*(H-30))]);
  const path='M '+pts.map(p=>p.join(',')).join(' L ');
  const area='M 0,'+H+' L '+pts.map(p=>p.join(',')).join(' L ')+` L ${W},${H} Z`;
  const trend=data[data.length-1].weight<=data[0].weight;
  const col=trend?'#c6ff00':'#ff3b3b';
  const delta=(data[data.length-1].weight-data[0].weight).toFixed(1);
  el.innerHTML=`<svg width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
    <defs>
      <linearGradient id="wg" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="${col}" stop-opacity="0.2"/>
        <stop offset="100%" stop-color="${col}" stop-opacity="0"/>
      </linearGradient>
    </defs>
    <path d="${area}" fill="url(#wg)"/>
    <path d="${path}" fill="none" stroke="${col}" stroke-width="2.5" stroke-linejoin="round"/>
    ${pts.map((p,i)=>`<circle cx="${p[0]}" cy="${p[1]}" r="3.5" fill="${col}"/>`).join('')}
    <text x="6" y="12" fill="rgba(255,255,255,0.3)" font-size="10" font-family="Outfit">${maxW+1}kg</text>
    <text x="6" y="${H-4}" fill="rgba(255,255,255,0.3)" font-size="10" font-family="Outfit">${minW-1}kg</text>
    <text x="${W-6}" y="12" fill="${col}" font-size="10" font-family="Outfit" text-anchor="end">Î” ${delta>0?'+':''}${delta}kg</text>
  </svg>`;
}

function addWeight(){
  const v=parseFloat((document.getElementById('pw-val')||{}).value);
  const d=(document.getElementById('pw-date')||{}).value||today();
  if(!v||v<20||v>300){showToast('âš ï¸ Poids invalide','err');return;}
  if(!db.poids) db.poids=[];
  const idx=db.poids.findIndex(p=>p.date===d);
  if(idx>=0) db.poids[idx].weight=v; else db.poids.push({date:d,weight:v});
  db.poids.sort((a,b)=>a.date.localeCompare(b.date));
  save();if(document.getElementById('pw-val'))document.getElementById('pw-val').value='';
  drawWeightChart();showToast('âš–ï¸ '+v+'kg enregistrÃ©','ok');
}
function delWeight(date){db.poids=(db.poids||[]).filter(p=>p.date!==date);save();drawWeightChart();}

function buildBody(){
  const measures=['Tour de taille','Tour de hanches','Tour de poitrine','Tour de bras (droit)','Tour de cuisse','Tour de mollet','% masse grasse'];
  return `<div class="chart-box">
    <div class="chart-hd">ğŸ“ Mensurations</div>
    <p style="font-size:.82rem;color:rgba(238,238,248,0.28);margin-bottom:16px">Saisis tes mesures actuelles pour suivre ta composition corporelle</p>
    <div class="body-grid" id="body-inputs">
      ${measures.map(m=>`
        <div class="fg">
          <label>${m}</label>
          <div style="display:flex;gap:6px;align-items:center">
            <input type="number" step="0.1" id="bm-${m.replace(/\s/g,'_')}" placeholder="cm" style="flex:1">
            <span style="font-size:.72rem;color:rgba(238,238,248,0.28)">${m.includes('%')?'%':'cm'}</span>
          </div>
        </div>`).join('')}
    </div>
    <button class="btn btn-lime btn-full" style="margin-top:16px" onclick="saveMeasures()">ğŸ’¾ Enregistrer mesures</button>
    <div id="body-history" style="margin-top:20px"></div>
  </div>`;
}

function loadBodyMeasures(){
  const latest=(db.measures||[]).slice(-1)[0];
  if(!latest) return;
  Object.entries(latest.data||{}).forEach(([k,v])=>{
    const el=document.getElementById('bm-'+k);
    if(el) el.value=v;
  });
  const hist=document.getElementById('body-history');
  if(hist&&db.measures.length>1){
    hist.innerHTML=`<div class="sec">Historique</div>`+(db.measures||[]).slice(-5).reverse().map(m=>`
      <div style="padding:8px 12px;background:#1a1a28;border-radius:8px;margin-bottom:6px;font-size:.8rem">
        <div style="font-weight:600;margin-bottom:4px;color:rgba(238,238,248,0.55)">${fDate(m.date)}</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          ${Object.entries(m.data||{}).map(([k,v])=>`<span style="color:rgba(238,238,248,0.28)">${k.replace(/_/g,' ')}: <strong style="color:#eeeef8">${v}</strong></span>`).join(' Â· ')}
        </div>
      </div>`).join('');
  }
}

function saveMeasures(){
  const measures=['Tour de taille','Tour de hanches','Tour de poitrine','Tour de bras (droit)','Tour de cuisse','Tour de mollet','% masse grasse'];
  const data={};
  measures.forEach(m=>{
    const v=parseFloat((document.getElementById('bm-'+m.replace(/\s/g,'_'))||{}).value);
    if(v) data[m.replace(/\s/g,'_')]=v;
  });
  if(!Object.keys(data).length){showToast('âš ï¸ Aucune mesure saisie','err');return;}
  if(!db.measures) db.measures=[];
  db.measures.push({date:today(),data});
  save();loadBodyMeasures();showToast('ğŸ“ Mensurations enregistrÃ©es','ok');
}

function buildMuscles(){
  const cnt={};
  db.workouts.forEach(w=>(w.exercises||[]).forEach(ex=>(ex.muscles||[]).forEach(m=>{cnt[m]=(cnt[m]||0)+1;})));
  const sorted=Object.entries(cnt).sort((a,b)=>b[1]-a[1]).slice(0,14);
  const max=(sorted[0] && sorted[0][1])||1;
  if(!sorted.length) return '<div class="empty"><div class="empty-icon">ğŸ’ª</div><p>Enregistre des sÃ©ances pour voir les statistiques</p></div>';
  return `<div class="chart-box">
    <div class="chart-hd">ğŸ’ª Muscles les plus travaillÃ©s</div>
    <div class="mheat">${sorted.map(([m,c])=>`
      <div class="mh-row">
        <div class="mh-top"><span class="mh-name">${m}</span><span class="mh-cnt">${c}Ã—</span></div>
        <div class="mh-tr"><div class="mh-tf" style="width:${(c/max*100).toFixed(0)}%"></div></div>
      </div>`).join('')}
    </div>
  </div>`;
}

function buildPRs(){
  const recs={};
  db.workouts.forEach(w=>(w.exercises||[]).forEach(ex=>{
    const k=ex.id||ex.name;
    (ex.sets||[]).forEach(s=>{
      if(s.weight>0&&(!recs[k]||s.weight>recs[k].weight))
        recs[k]={name:ex.name,weight:s.weight,date:w.date,vol:s.weight*(s.reps||1)};
    });
  }));
  const list=Object.values(recs).sort((a,b)=>b.weight-a.weight);
  if(!list.length) return '<div class="empty"><div class="empty-icon">ğŸ†</div><p>Enregistre des sÃ©ances avec du poids pour voir tes records</p></div>';
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  return `<div class="chart-box">
    <div class="chart-hd">ğŸ† Records personnels (charge max)</div>
    ${list.map((r,i)=>`
      <div class="pr-row">
        <div class="pr-pos" style="color:${i===0?'#ffd700':i===1?'#c0c0c0':i===2?'#cd7f32':'rgba(240,240,248,.35)'}">${medals[i]||i+1}</div>
        <div class="pr-info">
          <div class="pr-name">${r.name}</div>
          <div class="pr-date">${fDate(r.date)}</div>
        </div>
        <div class="pr-kg">${r.weight} kg</div>
      </div>`).join('')}
  </div>`;
}

function getLast10Weeks(){
  const w=[],n=new Date();
  for(let i=9;i>=0;i--){
    const e=new Date(n);e.setDate(n.getDate()-i*7);
    const s=new Date(e);s.setDate(e.getDate()-6);
    w.push({s,e});
  }
  return w;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   CUSTOM EXERCISE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let editCustomId=null;

function openCustomModal(id=null){
  editCustomId=id;
  document.getElementById('custom-title').textContent=id?'âœï¸ Modifier exercice':'âœï¸ Nouvel exercice';
  const fields=['ce-name','ce-met','ce-icon','ce-muscles','ce-desc','ce-tips'];
  if(id){
    const ex=(db.custom||[]).find(e=>e.id===id);
    if(ex){
      document.getElementById('ce-name').value=ex.name||'';
      document.getElementById('ce-cat').value=ex.cat||'Autre';
      document.getElementById('ce-type').value=ex.type||'Musculation';
      document.getElementById('ce-met').value=ex.met||5;
      document.getElementById('ce-icon').value=ex.icon||'';
      document.getElementById('ce-muscles').value=(ex.muscles||[]).join(', ');
      document.getElementById('ce-desc').value=ex.desc||'';
      document.getElementById('ce-tips').value=(ex.tips||[]).join('\n');
    }
  } else {
    fields.forEach(f=>document.getElementById(f)&&(document.getElementById(f).value=''));
  }
  updateCePreview();
  closeOv('ov-detail');
  openOv('ov-custom');
}

function updateCePreview(){
  const icon=(document.getElementById('ce-icon')||{}).value||'ğŸ‹ï¸';
  document.getElementById('ce-preview').textContent=icon;
}

function saveCustomEx(){
  const name=document.getElementById('ce-name').value.trim();
  if(!name){showToast('âš ï¸ Nom requis','err');return;}
  const met=parseFloat(document.getElementById('ce-met').value)||5;
  const muscles=document.getElementById('ce-muscles').value.split(',').map(m=>m.trim()).filter(Boolean);
  const tips=document.getElementById('ce-tips').value.split('\n').map(t=>t.trim()).filter(Boolean);
  if(!db.custom) db.custom=[];
  const exData={name,cat:document.getElementById('ce-cat').value,type:document.getElementById('ce-type').value,
    met,icon:document.getElementById('ce-icon').value||'ğŸ‹ï¸',muscles,
    desc:document.getElementById('ce-desc').value,tips,
    img:'',isCustom:true};
  if(editCustomId){
    const idx=db.custom.findIndex(e=>e.id===editCustomId);
    if(idx>=0) db.custom[idx]={...db.custom[idx],...exData};
  } else {
    db.custom.push({id:Date.now(),...exData});
  }
  save();closeOv('ov-custom');renderLib();
  showToast('âœ… Exercice '+(editCustomId?'modifiÃ©':'crÃ©Ã©'),'ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   CONFIRM / DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pendingDel=null;

function askDelete(type,id){
  const msgs={
    wo:{title:'Supprimer la sÃ©ance ?',msg:'Cette sÃ©ance sera dÃ©finitivement supprimÃ©e de ton historique. Impossible d\'annuler cette action.'},
    ex:{title:'Supprimer l\'exercice ?',msg:'Cet exercice personnalisÃ© sera supprimÃ© de ta bibliothÃ¨que.'},
  };
  const m=msgs[type]||{title:'Supprimer ?',msg:'Action irrÃ©versible.'};
  document.getElementById('cfm-title').textContent=m.title;
  document.getElementById('cfm-msg').textContent=m.msg;
  pendingDel={type,id};
  closeOv('ov-wo');closeOv('ov-detail');
  openOv('ov-confirm');
}

function doConfirm(){
  if(!pendingDel)return;
  const{type,id}=pendingDel;
  if(type==='wo'){
    db.workouts=db.workouts.filter(w=>w.id!==id);
    save();closeOv('ov-confirm');
    if(curPage==='dash')renderDash();
    if(curPage==='hist')renderHist();
    if(curPage==='prog')renderProg();
    showToast('ğŸ—‘ SÃ©ance supprimÃ©e','ok');
  }
  if(type==='ex'){
    db.custom=(db.custom||[]).filter(e=>e.id!==id);
    save();closeOv('ov-confirm');renderLib();
    showToast('ğŸ—‘ Exercice supprimÃ©');
  }
  pendingDel=null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   OVERLAY / MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openOv(id){document.getElementById(id).classList.add('on');}
function closeOv(id){document.getElementById(id).classList.remove('on');}
document.querySelectorAll('.overlay').forEach(el=>{
  el.addEventListener('click',e=>{if(e.target===el)closeOv(el.id);});
});
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.overlay.on').forEach(m=>closeOv(m.id));});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _toastTimer=null;
function showToast(msg,type=''){
  const el=document.getElementById('toast');
  el.textContent=msg;el.className='toast '+(type||'')+' show';
  clearTimeout(_toastTimer);
  _toastTimer=setTimeout(()=>el.classList.remove('show'),2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   WORKOUT TEMPLATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_TEMPLATES = [
  {id:'tpl1',name:'Push Day',type:'strength',exercises:[
    {id:1,sets:[{weight:80,reps:5},{weight:80,reps:5},{weight:80,reps:5},{weight:80,reps:5},{weight:80,reps:5}]},
    {id:3,sets:[{weight:60,reps:8},{weight:60,reps:8},{weight:60,reps:8}]},
    {id:4,sets:[{weight:20,reps:10},{weight:20,reps:10},{weight:20,reps:10}]},
    {id:14,sets:[{weight:12,reps:15},{weight:12,reps:15},{weight:12,reps:15}]},
    {id:19,sets:[{weight:30,reps:12},{weight:30,reps:12},{weight:30,reps:12}]},
  ]},
  {id:'tpl2',name:'Pull Day',type:'strength',exercises:[
    {id:7,sets:[{weight:0,reps:8},{weight:0,reps:8},{weight:0,reps:8},{weight:0,reps:6}]},
    {id:8,sets:[{weight:100,reps:5},{weight:100,reps:5},{weight:100,reps:5}]},
    {id:10,sets:[{weight:60,reps:10},{weight:60,reps:10},{weight:60,reps:10}]},
    {id:17,sets:[{weight:30,reps:10},{weight:30,reps:10},{weight:30,reps:10}]},
    {id:12,sets:[{weight:15,reps:15},{weight:15,reps:15},{weight:15,reps:15}]},
  ]},
  {id:'tpl3',name:'Leg Day',type:'strength',exercises:[
    {id:21,sets:[{weight:100,reps:5},{weight:100,reps:5},{weight:100,reps:5},{weight:100,reps:5},{weight:100,reps:5}]},
    {id:11,sets:[{weight:80,reps:8},{weight:80,reps:8},{weight:80,reps:8}]},
    {id:22,sets:[{weight:150,reps:12},{weight:150,reps:12},{weight:150,reps:12}]},
    {id:24,sets:[{weight:80,reps:12},{weight:80,reps:12},{weight:80,reps:12}]},
    {id:27,sets:[{weight:50,reps:15},{weight:50,reps:15},{weight:50,reps:15}]},
  ]},
  {id:'tpl4',name:'KB Full Body',type:'mixed',exercises:[
    {id:32,sets:[{weight:24,reps:20},{weight:24,reps:20},{weight:24,reps:20}]},
    {id:36,sets:[{weight:20,reps:12},{weight:20,reps:12},{weight:20,reps:12}]},
    {id:34,sets:[{weight:16,reps:8},{weight:16,reps:8},{weight:16,reps:8}]},
    {id:39,sets:[{weight:16,reps:8},{weight:16,reps:8}]},
  ]},
];

function openTemplateModal(){
  const all = [...DEFAULT_TEMPLATES,...(db.templates||[])];
  const el = document.getElementById('tpl-list');
  if(!all.length){el.innerHTML='<div class="empty"><p>Aucun template</p></div>';openOv('ov-templates');return;}
  el.innerHTML = all.map(t=>`
    <div class="wo-item hov" style="flex-direction:column;align-items:flex-start;gap:6px;cursor:default">
      <div style="display:flex;align-items:center;width:100%;gap:8px">
        <div style="flex:1;font-weight:600;font-size:.9rem">${t.name}</div>
        <button class="btn btn-lime btn-sm" onclick="loadTemplate('${t.id}')">â–¶ Charger</button>
        ${t.isCustom?`<button class="btn btn-red btn-sm" onclick="deleteTemplate('${t.id}')">ğŸ—‘</button>`:''}
      </div>
      <div style="font-size:.72rem;color:var(--txt3)">${(t.exercises||[]).length} exercices Â· ${t.type||'strength'}</div>
    </div>`).join('');
  openOv('ov-templates');
}

function loadTemplate(id){
  const all = [...DEFAULT_TEMPLATES,...(db.templates||[])];
  const tpl = all.find(t=>t.id===id);
  if(!tpl)return;
  const allEx = getAllEx();
  logStrengthExs = (tpl.exercises||[]).map(te=>{
    const ex = allEx.find(e=>e.id===te.id);
    if(!ex)return null;
    return{ex,sets:(te.sets||[{weight:0,reps:10,done:false}]).map(s=>({...s,done:false}))};
  }).filter(Boolean);
  setSessionType(tpl.type||'strength');
  if(tpl.name) document.getElementById('log-name').value=tpl.name;
  closeOv('ov-templates');
  renderStrengthList();
  updateSummary();
  showToast('ğŸ“‹ Template chargÃ©!','ok');
}

function saveAsTemplate(){
  if(!logStrengthExs.length){showToast('âš ï¸ Aucun exercice Ã  sauver','err');return;}
  const name=document.getElementById('log-name').value.trim()||'Mon Template';
  if(!db.templates) db.templates=[];
  db.templates.push({
    id:'tpl_'+Date.now(),
    name,
    type:sessionType,
    exercises:logStrengthExs.map(e=>({id:e.ex.id,sets:e.sets.map(s=>({weight:s.weight,reps:s.reps}))})),
    isCustom:true
  });
  save();
  closeOv('ov-templates');
  showToast('âœ… Template sauvegardÃ©!','ok');
}

function deleteTemplate(id){
  db.templates=(db.templates||[]).filter(t=>t.id!==id);
  save();
  openTemplateModal();
  showToast('ğŸ—‘ Template supprimÃ©');
}

load();
renderDash();

// Input debounce for live calorie update
document.getElementById('log-bw') && document.getElementById('log-bw').addEventListener('input', updateSummary);
document.getElementById('log-intensity') && document.getElementById('log-intensity').addEventListener('change', updateSummary);

// Auto-save every 30 seconds
setInterval(()=>{
  save();
  const dot = document.querySelector('.save-dot');
  if(dot){dot.style.background='#c6ff00';dot.style.boxShadow='0 0 12px rgba(198,255,0,0.5)';setTimeout(()=>{dot.style.background='';dot.style.boxShadow='';},800);}
}, 30000);

// â”€â”€ Swipe left/right to change page (mobile) â”€â”€
(function(){
  const pages=['dash','lib','log','hist','prog'];
  let sx=0,sy=0;
  document.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;},{passive:true});
  document.addEventListener('touchend',e=>{
    const dx=e.changedTouches[0].clientX-sx;
    const dy=Math.abs(e.changedTouches[0].clientY-sy);
    if(Math.abs(dx)>65&&dy<40){
      const i=pages.indexOf(curPage);
      if(dx<0&&i<pages.length-1)goPage(pages[i+1]);
      else if(dx>0&&i>0)goPage(pages[i-1]);
    }
  },{passive:true});
})();

</script>
</body>
</html>
